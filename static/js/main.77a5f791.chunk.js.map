{"version":3,"sources":["Header.tsx","Footer.tsx","ImportDialog.tsx","utils.ts","edgeMarkup.ts","EdgeMarkDialog.tsx","ToolBar.tsx","ViewDialogs.tsx","InfoBoard.tsx","CircularProgressWithLabel.tsx","NetView.tsx","TimeSlider.tsx","EditGrid.js","Comments.tsx","NetPage.tsx","CodeBlock.tsx","DocPage.tsx","App.tsx","serviceWorker.ts","index.tsx"],"names":["Header","className","href","this","props","title","React","Component","Busuanzi","window","location","endsWith","id","Footer","ImportDialog","state","open","sourceUrl","items","selected","setState","length","loadSource","event","target","value","fetch","then","res","json","data","error","console","log","newValue","url","newInfo","info_a","info_b","new_","Object","assign","entries","categories","k","v","nodes","concat","n","edges","e","values","push","mergeInfo","info","setInfo","handleClose","loadItem","onClick","handleClickOpen","Dialog","onClose","aria-labelledby","DialogTitle","DialogContent","Typography","gutterBottom","InputBase","onChange","sourceChanged","placeholder","Autocomplete","onSelectedChange","options","getOptionLabel","item","name","renderInput","params","TextField","label","variant","DialogActions","Button","color","handleClickConfirm","Label","P","map","s","ExplicitLabel","ExplicitID","Obj","dash","rightArrow","leftArrow","EdgeLabel","l","UndirectedEdge","left","from","to","directed","DirectedRightEdge","DirectedLeftEdge","LineParser","EdgeMarkDialog","content","markers","setText","texts","direction","lines","split","idx","line","replace","parse","status","nodes_from","queryNodes","nodes_to","n_from","n_to","edge","startRow","endRow","startCol","endCol","type","processLines","err","DialogContentText","mode","theme","textChanged","bind","width","height","fontSize","ref","buildFileSelector","fileSelector","document","createElement","setAttribute","addEventListener","file","files","reader","FileReader","onload","JSON","result","undefined","readAsText","UploadBtn","handleFileSelect","preventDefault","click","ToolBar","objectData","fileName","navigator","msSaveOrOpenBlob","blob","Blob","decodeURIComponent","encodeURI","stringify","a","download","encodeURIComponent","body","appendChild","removeChild","exportToJson","EditOptionsDialog","setTextArea","opt","getOpt","setOpt","ta","getElementById","style","border","tip","innerHTML","Tooltip","placement","rows","cols","SearchDialog","queryText","q","queryAndFocus","key","handleClickSearch","onKeyPress","handlePressEnter","IconButton","FilterDialog","reverse","queryAndFilter","reset","handleClickFilter","checked","handleClickReset","Checkbox","handleChangeReverse","defaultOpt","oldOpt","atlas","physics","solver","forceAtlas2Based","gravitationalConstant","centralGravity","springLength","springConstant","font","size","GravitationalConstantSlider","useState","setValue","Slider","min","max","valueLabelDisplay","SpringConstantSlider","Math","log10","newVal","step","valueLabelFormat","CustomSwitch","withStyles","switchBase","backgroundColor","track","Switch","PhysicsSwitch","enabled","HiddenEdgeLabelSwitch","TuneDialog","InforBoardSwitch","FormControlLabel","control","switchState","setSwitch","labelPlacement","HiddenUnselectedSwitch","SettingDialog","inforBoardSwitch","setInforBoardSwitch","hiddenUnselectedSwitch","setHiddenUnselectedSwitch","node","pos","cat","cats","categorie","boardStyle","top","y","x","catStyle","close","src","image","alt","str","limit","slice","shorterString","link","Box","position","display","CircularProgress","bottom","right","alignItems","justifyContent","component","round","getCanvas","getElementsByTagName","DefaultNetStyle","ViewControl","fullScreenMode","setFullScreenMode","oriHeight","turnBackSize","captureImg","exitFullscreen","canvas","fullRegion","requestFullscreen","clientHeight","screen","fullscreenElement","DEFAULT_NETWORK_OPTIONS","autoResize","shape","stabilization","inherit","interaction","hideEdgesOnDrag","hover","multiselect","NetView","infoBoard","loadingRatio","netRef","createRef","netOptions","oldNodes","on","oldState","resetNodes","hiddenNonSelected","node_id","current","network","getNodeAt","pointer","DOM","select_node","create_board","find","InfoBoard","board","handlePopup","handleHidden","setOptions","setNetOptions","registerLoading","createLoadindBar","handleClick","catgories","borderWidth","createNode","arrows","createEdge","self","ratio","iterations","total","once","context","getContext","save","globalCompositeOperation","fillStyle","fillRect","restore","toDataURL","selectNodes","nodes_id","String","fit","animation","focus","scale","setNodes","getSelectedNodes","closure","Set","nid","add","parseInt","connected","getConnectedNodes","nid2","getSelectedClosure","has","createNetwork","getNetOptions","queryNodesAndFocus","queryNodesAndFilter","useStyles","makeStyles","createStyles","root","margin","spacing","timePoints","classes","i","marks","t","defaultValue","time","setTime","commandComponents","onExecute","textAlign","edit","delete","confirm","commit","cancel","Command","CommandButton","availableValues","LookupEditCell","lookupEditCell","padding","dialog","inputRoot","selectMenu","availableColumnValues","onValueChange","TableCell","Select","MenuProps","input","Input","MenuItem","EditCell","column","Cell","getRowId","row","createGrid","colDef","getParentState","widthDef","colOrder","defaultDef","setParentState","columns","tableColumnExtensions","sorting","editingRowIds","addedRows","rowChanges","currentPage","pageSize","pageSizes","columnOrder","leftFixedColumns","TableEditColumn","COLUMN_TYPE","totalSummaryItems","defaultRow","keys","deletedIds","rowsForDelete","forEach","rowId","index","findIndex","splice","changedRows","added","changed","deleted","startingAddedId","deleteRows","nextProps","newRows","Paper","onSortingChange","onCurrentPageChange","c","onPageSizeChange","onEditingRowIdsChange","ids","onRowChangesChange","onAddedRowsChange","changeAddedRows","onCommitChanges","commitChanges","totalItems","columnExtensions","order","onOrderChange","showSortingControls","cellComponent","showAddCommand","showEditCommand","showDeleteCommand","commandComponent","leftColumns","NodeGrid","columnName","r","EdgeGrid","e_","setEdges","CatGrid","reprCats","setCats","recoverCats","Comments","script","anchor","issueTerm","Accordion","AccordionSummary","expandIcon","aria-controls","AccordionDetails","NetPage","isLoaded","timesInfo","currentTime","nodeCache","timepoints","Array","Promise","all","resp","infos_","infos","new_nodes","preProcessInfo","cache","times","query_type","query_text","trim","toggle","cond","pattern","RegExp","val","test","message","forceRender","setCategories","TimeSlider","setCurrentTime","CodeBlock","language","PureComponent","defaultProps","DocPage","text","source","renderers","code","escapeHtml","Card","titleImg","NewCard","Cards","Home","App","basename","exact","path","Boolean","hostname","match","ReactDOM","render","StrictMode","serviceWorker","ready","registration","unregister","catch"],"mappings":"gUAMqBA,G,qLAEjB,OACE,gCACE,yBAAKC,UAAU,cACb,yBAAKA,UAAU,aACb,yBAAKA,UAAU,UACb,yBAAKA,UAAU,SACb,uBAAGC,KAAK,gBAAR,4BAGA,uBAAGA,KAAK,WAAR,gBAGA,uBAAGA,KAAK,qCAAR,aAMN,yBAAKD,UAAU,mBACb,uBAAGA,UAAU,OACX,uBAAGC,KAAK,KAAR,WAIF,4BAAKC,KAAKC,MAAMC,c,GA1BQC,IAAMC,Y,oCCDpCC,EAAW,WAEf,OADeC,OAAOC,SAASR,KAAKS,SAAS,MAGzC,yBAAKV,UAAU,YACb,0BAAMW,GAAG,8BAAT,wCAA6C,0BAAMA,GAAG,2BAAtD,YAKF,sCAMeC,E,uKAEjB,OACE,yBAAKZ,UAAU,UACb,yBAAKA,UAAU,aACb,uBAAGC,KAAK,qCACN,kBAAC,IAAD,OAEF,uBAAGA,KAAK,6BACN,kBAAC,IAAD,CAAWU,GAAG,gBAGhB,kBAAC,EAAD,Y,GAZ0BN,IAAMC,W,yFCSrBO,E,kDAEnB,WAAYV,GAA2B,IAAD,8BACpC,cAAMA,IACDW,MAAQ,CACXC,MAAM,EACNC,UAAW,gFACXC,MAAO,GACPC,SAAU,MANwB,E,8DAWpChB,KAAKiB,SAAS,CAACJ,MAAM,IACW,IAA5Bb,KAAKY,MAAMG,MAAMG,QACnBlB,KAAKmB,e,oCAKPnB,KAAKiB,SAAS,CAACJ,MAAM,M,oCAGTO,GACZpB,KAAKiB,SAAS,CACZH,UAAWM,EAAMC,OAAOC,QAE1BtB,KAAKmB,e,mCAGO,IAAD,OACXI,MAAMvB,KAAKY,MAAME,WACdU,MAAK,SAAAC,GAAG,OAAIA,EAAIC,UAChBF,MAAK,SAAAG,GACJ,EAAKV,SAAS,CACZF,MAAOY,EAAKA,UAGhB,SAACC,GACCC,QAAQC,IAAIF,GACZ,EAAKX,SAAS,CACZF,MAAO,U,uCAKEK,EAAYW,GAC3B/B,KAAKiB,SAAS,CACZD,SAAUe,M,iCAIF,IAAD,OACT,GAA4B,OAAxB/B,KAAKY,MAAMI,SAAf,CACA,IAAMgB,EAAMhC,KAAKY,MAAMI,SAASW,KAChCJ,MAAMS,GACHR,MAAK,SAAAC,GAAG,OAAIA,EAAIC,UAChBF,MAAK,SAAAG,GACJ,IAAMM,EC5DI,SAACC,EAAkBC,GAEnC,IADA,IAAIC,EAAOC,OAAOC,OAAO,GAAIJ,GAC7B,MAAqBG,OAAOE,QAAQJ,EAAOK,YAA3C,eAAwD,CAAC,IAAD,sBAA5CC,EAA4C,KAAzCC,EAAyC,KACtDN,EAAKI,WAAWC,GAAKC,EAEvB,IALwD,EAKpDC,EAAkC,GALkB,cAMxCT,EAAOP,KAAKgB,MAAMC,OAAOT,EAAOR,KAAKgB,QANG,IAMxD,2BAA6D,CAAC,IAAnDE,EAAkD,QAC3DF,EAAME,EAAEpC,IAAMoC,GAPwC,8BASxD,IATwD,EASpDC,EAAkC,GATkB,cAUxCZ,EAAOP,KAAKmB,MAAMF,OAAOT,EAAOR,KAAKmB,QAVG,IAUxD,2BAA6D,CAAC,IAAnDC,EAAkD,QAC3DD,EAAMC,EAAEtC,IAAMsC,GAXwC,8BAaxDX,EAAKT,KAAKgB,MAAQ,GAClB,cAAgBN,OAAOW,OAAOL,GAA9B,eAAsC,CAAjC,IAAME,EAAC,KAA2BT,EAAKT,KAAKgB,MAAMM,KAAKJ,GAC5DT,EAAKT,KAAKmB,MAAQ,GAClB,cAAgBT,OAAOW,OAAOF,GAA9B,eAAsC,CAAjC,IAAMC,EAAC,KAA2BX,EAAKT,KAAKmB,MAAMG,KAAKF,GAC5D,OAAOX,ED2Cec,CAAU,EAAKjD,MAAMkD,KAAMxB,GAC3C,EAAK1B,MAAMmD,QAAQnB,MAErB,SAACL,GACCC,QAAQC,IAAIF,MAEhB5B,KAAKqD,iB,2CAILrD,KAAKsD,a,+BAGG,IAAD,OACP,OACE,oCACE,4BAAQC,QAAS,kBAAM,EAAKC,oBAA5B,8CACA,kBAACC,EAAA,EAAD,CAAQ5C,KAAMb,KAAKY,MAAMC,KAAM6C,QAAS,WAAO,EAAKL,eAAgBM,kBAAgB,qBAClF,kBAACC,EAAA,EAAD,CAAanD,GAAG,qBAAhB,wCAEA,kBAACoD,EAAA,EAAD,CAAepD,GAAG,gBAChB,kBAACqD,EAAA,EAAD,CAAYC,cAAY,GAAxB,sBAGA,kBAACC,EAAA,EAAD,CACE1C,MAAOtB,KAAKY,MAAME,UAClBmD,SAAU,SAAClB,GAAD,OAAO,EAAKmB,cAAcnB,IACpCoB,YAAY,qEAEd,kBAACL,EAAA,EAAD,CAAYC,cAAY,GAAxB,gBAGA,kBAACK,EAAA,EAAD,CACE9C,MAAOtB,KAAKY,MAAMI,SAClBiD,SAAU,SAAClB,EAAGF,GAAO,EAAKwB,iBAAiBtB,EAAGF,IAC9CpC,GAAG,sBACH6D,QAAStE,KAAKY,MAAMG,MACpBwD,eAAgB,SAACC,GAAD,OAAsBA,EAAKC,MAC3CC,YAAa,SAACC,GAAD,OAAiB,kBAACC,EAAA,EAAD,iBAAeD,EAAf,CAAuBE,MAAM,eAAKC,QAAQ,iBAG1E,kBAACC,EAAA,EAAD,KACE,kBAACC,EAAA,EAAD,CAAQzB,QAAS,WAAO,EAAKF,eAAgB4B,MAAM,WAAnD,gBAGA,kBAACD,EAAA,EAAD,CAAQzB,QAAS,WAAO,EAAK2B,sBAAuBD,MAAM,WAA1D,wB,GAvG4B9E,IAAMC,W,mDEI1C+E,EACJC,SAHc,6BAIZC,KAAI,SAAAC,GAAC,OAAIA,KAEPC,EACJH,MAAMA,SAAS,WAAYD,EAAOC,SAAS,MACzCC,KACC,mCAAMR,GAAN,uBAAqBA,KAGpBW,EACJJ,MAAMA,SAAS,QAASA,QAAQ,UAAWA,SAAS,MAClDC,KACC,mCAAM5E,GAAN,sBAAkB,MAAMA,KAGvBgF,EACJL,MACEG,EACAC,EACAL,GAIEO,EAAON,QAAQ,MACfO,EAAaP,MAAMM,EAAMN,SAAS,MAClCQ,EAAYR,MAAMA,SAAS,KAAMM,GAGjCG,EAAYT,MAEhBA,MACEA,SAAS,KACTA,MAAMD,EAAOC,SAAS,KACtBA,SAAS,MACVC,KAAI,mCAAMS,GAAN,uBAAiBA,KAEtBX,GAIIY,EACJX,MAAMK,EAAKC,EAAMG,EAAWH,EAAMD,GAChCJ,KACC,YAAmC,IAAD,mBAAhCW,EAAgC,KAAtBnB,GAAsB,gBAChC,MAAO,CACLA,MAAOA,EACPoB,KAAMD,EACNE,GAJ8B,KAK9BC,UAAU,MAKbC,EACJhB,MAAMK,EAAKC,EAAMG,EAAWF,EAAYF,GACtCJ,KACC,YAAmC,IAAD,mBAAhCW,EAAgC,KAAtBnB,GAAsB,gBAChC,MAAO,CACLA,MAAOA,EACPoB,KAAMD,EACNE,GAJ8B,KAK9BC,UAAU,MAKbE,EACJjB,MAAMK,EAAKG,EAAWC,EAAWH,EAAMD,GACrCJ,KACC,YAAmC,IAAD,mBAAhCW,EAAgC,KAAtBnB,GAAsB,gBAChC,MAAO,CACLA,MAAOA,EACPoB,KAH8B,KAI9BC,GAAIF,EACJG,UAAU,MAKbG,EACJlB,MACEA,QAAQ,UACRA,MACEW,EACAM,EACAD,GAEFhB,QAAQ,WAETC,KACC,mCAAMtC,GAAN,uBAAiBA,KClGAwD,E,kDACnB,WAAYtG,GAAe,IAAD,8BACxB,cAAMA,IACDW,MAAQ,CACXC,MAAM,EACN2F,QAAS,GACTC,QAAS,IALa,E,8DAUxBzG,KAAK0G,UACL1G,KAAKiB,SAAS,CAACJ,MAAM,M,oCAIrBb,KAAKiB,SAAS,CAACJ,MAAM,M,kCAGXkB,GACV/B,KAAKiB,SAAS,CACZuF,QAASzE,M,gCAKX,IADQ,EACJ4E,EAAQ,GADJ,cAEQ3G,KAAKC,MAAMkD,KAAKxB,KAAKmB,OAF7B,IAER,2BAA4C,CAAC,IAAlCC,EAAiC,QAC1C4D,GAAS,OAAS5D,EAAEkD,KAAX,MACOlD,EAAE8B,OAAwB,GAAf9B,EAAE6D,UAAqB,KAAO,UAChD,OAAS7D,EAAEmD,GAAK,OALnB,8BAORlG,KAAKiB,SAAS,CACZuF,QAASG,M,qCAKX,IADa,EACPE,EAAQ7G,KAAKY,MAAM4F,QAAQM,MAAM,SACnChE,EAAQ,GACR2D,EAAU,GACVM,EAAM,EAJG,cAKMF,GALN,IAKb,2BAA0B,CAAC,IAAhBG,EAAe,QACxB,GAA8C,IAA1CA,EAAKC,QAAQ,aAAc,IAAI/F,OAAnC,CAGA,IAAMO,EAAM6E,EAAWY,MAAMF,GAC7B,IAAmB,IAAfvF,EAAI0F,OAAiB,CACvB,IAAMpE,EAAItB,EAAIH,MAER8F,EAAapH,KAAKC,MAAMoH,WAAWtE,EAAEkD,MAAM,GAC3CqB,EAAWtH,KAAKC,MAAMoH,WAAWtE,EAAEmD,IAAI,GAC7C,GAAKkB,EAAWlG,QAAU,GAAOoG,EAASpG,QAAU,EAAI,CACtD,IAAMqG,EAASH,EAAW,GACpBI,EAAOF,EAAS,GAChBG,EAAO,CACXhH,GAAIsG,EACJd,KAAMsB,EAAO9G,GACbyF,GAAIsB,EAAK/G,GACToE,MAAO9B,EAAE8B,MACT+B,UAAW7D,EAAEoD,UAEfrD,EAAMG,KAAKwE,QAGXhB,EAAQxD,KAAK,CACXyE,SAAUX,EACVY,OAAQZ,EACRa,SAAU,EACVC,OAAQb,EAAK9F,OACbpB,UAAW,mBACXgI,KAAM,cAKVrB,EAAQxD,KAAK,CACXyE,SAAUX,EACVY,OAAQZ,EACRa,SAAU,EACVC,OAAQb,EAAK9F,OACbpB,UAAW,oBACXgI,KAAM,SAGVf,GAAO,IAhDI,8BAkDb,IAAI5D,EAAOd,OAAOC,OAAO,GAAItC,KAAKC,MAAMkD,MACxCA,EAAKxB,KAAKmB,MAAQA,EAClB9C,KAAKC,MAAMmD,QAAQD,GACnBnD,KAAKiB,SAAS,CACZwF,QAASA,M,2CAKX,IACEzG,KAAK+H,eACL,MAAMC,GACNnG,QAAQC,IAAIkG,M,+BAIN,IAAD,OACP,OACE,yBAAKlI,UAAU,qBACb,4BAAQyD,QAAS,kBAAM,EAAKC,oBAA5B,6BACA,kBAACC,EAAA,EAAD,CAAQ5C,KAAMb,KAAKY,MAAMC,KAAM6C,QAAS,WAAO,EAAKL,eAAgBM,kBAAgB,qBAClF,kBAACC,EAAA,EAAD,CAAanD,GAAG,qBAAhB,6BACA,kBAACoD,EAAA,EAAD,KACE,kBAACoE,EAAA,EAAD,sHACsB,4CAEtB,uBAAGxH,GAAG,sBAAN,KACA,kBAAC,IAAD,CACEa,MAAOtB,KAAKY,MAAM4F,QAClB0B,KAAK,OACLC,MAAM,SACNlE,SAAUjE,KAAKoI,YAAYC,KAAKrI,MAChCsI,MAAM,QACNC,OAAO,QACPC,SAAU,GACV/B,QAASzG,KAAKY,MAAM6F,QACpBgC,IAAI,eAGR,kBAAC1D,EAAA,EAAD,KACE,kBAACC,EAAA,EAAD,CAAQzB,QAAS,WAAO,EAAKF,eAAgB4B,MAAM,WAAnD,gBAGA,kBAACD,EAAA,EAAD,CAAQzB,QAAS,WAAO,EAAK2B,sBAAuBD,MAAM,WAA1D,uB,GAlIgC9E,IAAMC,WClB5CsI,EAAoB,SAACtF,GACzB,IAAMuF,EAAeC,SAASC,cAAc,SAe5C,OAdAF,EAAaG,aAAa,OAAQ,QAClCH,EAAaG,aAAa,WAAY,YACtCH,EAAaG,aAAa,SAAU,SACpCH,EAAaI,iBAAiB,UAAU,SAAC3H,GACvC,IACI4H,EADW5H,EAAMC,OACI4H,MAAmB,GACxCC,EAAS,IAAIC,WACjBD,EAAOE,OAAS,WACdhG,EAAQiG,KAAKnC,MAAMgC,EAAOI,eAEfC,IAATP,GACFE,EAAOM,WAAWR,MAGfL,GAWHc,E,4MAOJC,iBAAmB,SAAC3G,GAClBA,EAAE4G,iBACF,EAAK/I,MAAM+H,aAAaiB,S,kEAPxB5J,KAAKiB,SAAS,CACZ0H,aAAcD,EAAkB1I,KAAKC,MAAMmD,a,+BAU7C,OAAO,4BAAQG,QAASvD,KAAK0J,kBAAtB,gC,GAbavJ,IAAMC,WAwBTyJ,E,uKACT,IAAD,OACP,OACE,yBAAK/J,UAAU,WACb,yBAAKA,UAAU,aACb,kBAAC,EAAD,CAAcqD,KAAMnD,KAAKC,MAAMkD,KAAMC,QAASpD,KAAKC,MAAMmD,UACzD,kBAAC,EAAD,CAAgBD,KAAMnD,KAAKC,MAAMkD,KAAMC,QAASpD,KAAKC,MAAMmD,QAASiE,WAAYrH,KAAKC,MAAMoH,aAC3F,kBAAC,EAAD,CAAWjE,QAASpD,KAAKC,MAAMmD,UAC/B,4BAAQG,QAAS,YHlEN,SAACuG,EAAiBC,GAErC,GAAIzJ,OAAO0J,WAAa1J,OAAO0J,UAAUC,iBAAkB,CACzD,IAAIC,EAAO,IAAIC,KAAK,CAACC,mBAAmBC,UAAUhB,KAAKiB,UAAUR,MAAgB,CAAEhC,KAFnE,oCAGhBkC,UAAUC,iBAAiBC,EAAMH,OAC5B,CACL,IAAIQ,EAAI3B,SAASC,cAAc,KAC/B0B,EAAEC,SAAWT,EACbQ,EAAExK,KAAO,wCAA8B0K,mBAAmBpB,KAAKiB,UAAUR,EAAY,KAAM,IAC3FS,EAAElJ,OAAS,SACXuH,SAAS8B,KAAKC,YAAYJ,GAC1BA,EAAEX,QACFhB,SAAS8B,KAAKE,YAAYL,IGsDIM,CAAa,EAAK5K,MAAMkD,KAAM,iBAAtD,kC,GAR2BhD,IAAMC,W,8PC3BrC0K,G,kDACJ,WAAY7K,GAAgC,IAAD,8BACzC,cAAMA,IACDW,MAAQ,CACXC,MAAM,EACN2F,QAAS,IAJ8B,E,8DASzCxG,KAAKiB,SAAS,CAACJ,MAAM,IACrBb,KAAK+K,gB,oCAIL/K,KAAKiB,SAAS,CAACJ,MAAM,M,oCAIrB,IAAImK,EAAMhL,KAAKC,MAAMgL,SACjBzE,EAAU6C,KAAKiB,UAAUU,EAAK,KAAM,GACxChL,KAAKiB,SAAS,CAACuF,QAASA,M,kCAGdpF,GACVpB,KAAKiB,SAAS,CACZuF,QAASpF,EAAMC,OAAOC,U,2CAKxB,IAAIgD,EACJ,IACEA,EAAU+E,KAAKnC,MAAMlH,KAAKY,MAAM4F,SAChCxG,KAAKC,MAAMiL,OAAO5G,GAClBtE,KAAKiB,SAAS,CAACJ,MAAM,IACrB,MAAMmH,GACNnG,QAAQC,IAAIkG,GACZ,IAAImD,EAAKvC,SAASwC,eAAe,wBACtB,OAAPD,IACFA,EAAGE,MAAMC,OAAS,qBAEpB,IAAIC,EAAM3C,SAASwC,eAAe,qBAClCvJ,QAAQC,IAAIyJ,GACA,OAARA,IACFA,EAAIC,UAAY,8DAChBD,EAAIF,MAAMpG,MAAQ,UAClBsG,EAAIF,MAAM7C,SAAW,W,+BAKjB,IAAD,OACP,OACE,yBAAK1I,UAAU,qBACb,kBAAC2L,GAAA,EAAD,CAASvL,MAAM,uCAASwL,UAAU,OAChC,kBAAC,KAAD,CAAUnI,QAAS,WAAO,EAAKC,sBAEjC,kBAACC,EAAA,EAAD,CAAQ5C,KAAMb,KAAKY,MAAMC,KAAM6C,QAAS,WAAO,EAAKL,eAAgBM,kBAAgB,qBAClF,kBAACC,EAAA,EAAD,CAAanD,GAAG,qBAAhB,oDACA,kBAACoD,EAAA,EAAD,KACE,kBAACoE,EAAA,EAAD,oKAEE,uBAAGlI,KAAK,qDAAR,4BAFF,WAIA,uBAAGU,GAAG,qBAAN,KACA,8BAAUA,GAAG,uBACXkL,KAAM,GAAIC,KAAM,GAChBtK,MAAOtB,KAAKY,MAAM4F,QAClBvC,SAAU,SAAClB,GAAO,EAAKqF,YAAYrF,OAGvC,kBAACgC,EAAA,EAAD,KACE,kBAACC,EAAA,EAAD,CAAQzB,QAAS,WAAO,EAAKF,eAAgB4B,MAAM,WAAnD,gBAGA,kBAACD,EAAA,EAAD,CAAQzB,QAAS,WAAO,EAAK2B,sBAAuBD,MAAM,WAA1D,uB,GA5EoB9E,IAAMC,WA+FhCyL,G,kDACJ,WAAY5L,GAA2B,IAAD,8BACpC,cAAMA,IACDW,MAAQ,CACXC,MAAM,EACNiL,UAAW,IAJuB,E,8DASpC9L,KAAKiB,SAAS,CAACJ,MAAM,M,oCAIrBb,KAAKiB,SAAS,CAACJ,MAAM,M,0CAIrB,IAAMkL,EAAI/L,KAAKY,MAAMkL,UACrB9L,KAAKC,MAAM+L,cAAcD,GACzB/L,KAAKiB,SAAS,CAACJ,MAAM,EAAOiL,UAAW,O,kCAG7B1K,GACVpB,KAAKiB,SAAS,CACZ6K,UAAW1K,EAAMC,OAAOC,U,uCAIXF,GACG,UAAdA,EAAM6K,KACRjM,KAAKkM,sB,+BAIC,IAAD,OACP,OACE,oCACE,kBAACT,GAAA,EAAD,CAASvL,MAAM,eAAKwL,UAAU,OAC5B,kBAAC,KAAD,CAAYnI,QAAS,kBAAM,EAAKC,sBAElC,kBAACC,EAAA,EAAD,CAAQ5C,KAAMb,KAAKY,MAAMC,KAAM6C,QAAS,WAAO,EAAKL,eAAgBM,kBAAgB,qBAClF,kBAACE,EAAA,EAAD,CAAepD,GAAG,gBAChB,kBAACuD,EAAA,EAAD,CACE1C,MAAOtB,KAAKY,MAAMkL,UAClB7H,SAAU,SAAClB,GAAD,OAAO,EAAKqF,YAAYrF,IAClCoJ,WAAY,SAACpJ,GAAD,OAAO,EAAKqJ,iBAAiBrJ,IACzCoB,YAAY,mIAEd,kBAACkI,GAAA,EAAD,CAAYvE,KAAK,SAASvE,QAAS,kBAAM,EAAK2I,sBAC5C,kBAAC,KAAD,c,GAlDa/L,IAAMC,WAsE3BkM,G,kDACJ,WAAYrM,GAA2B,IAAD,8BACpC,cAAMA,IACDW,MAAQ,CACXC,MAAM,EACNiL,UAAW,GACXS,SAAS,GALyB,E,8DAUpCvM,KAAKiB,SAAS,CAACJ,MAAM,M,oCAIrBb,KAAKiB,SAAS,CAACJ,MAAM,M,0CAIrB,IAAMkL,EAAI/L,KAAKY,MAAMkL,UACrB9L,KAAKC,MAAMuM,eAAeT,EAAG/L,KAAKY,MAAM2L,SACxCvM,KAAKiB,SAAS,CAACJ,MAAM,EAAOiL,UAAW,O,yCAIrC9L,KAAKC,MAAMwM,QACXzM,KAAKiB,SAAS,CAACJ,MAAM,EAAOiL,UAAW,O,kCAG/B1K,GACVpB,KAAKiB,SAAS,CACZ6K,UAAW1K,EAAMC,OAAOC,U,uCAIXF,GACG,UAAdA,EAAM6K,KACRjM,KAAK0M,sB,0CAIWtL,GAClBpB,KAAKiB,SAAS,CACZsL,QAASnL,EAAMC,OAAOsL,Y,+BAIhB,IAAD,OACP,OACE,oCACE,kBAAClB,GAAA,EAAD,CAASvL,MAAM,eAAKwL,UAAU,OAC5B,kBAAC,KAAD,CAAgBnI,QAAS,kBAAM,EAAKC,sBAEtC,kBAACC,EAAA,EAAD,CAAQ5C,KAAMb,KAAKY,MAAMC,KAAM6C,QAAS,WAAO,EAAKL,eAAgBM,kBAAgB,qBAClF,kBAACE,EAAA,EAAD,CAAepD,GAAG,gBAChB,kBAACuD,EAAA,EAAD,CACE1C,MAAOtB,KAAKY,MAAMkL,UAClB7H,SAAU,SAAClB,GAAD,OAAO,EAAKqF,YAAYrF,IAClCoJ,WAAY,SAACpJ,GAAD,OAAO,EAAKqJ,iBAAiBrJ,IACzCoB,YAAY,2HAEd,kBAACkI,GAAA,EAAD,CAAYvE,KAAK,SAASvE,QAAS,kBAAM,EAAKmJ,sBAC5C,kBAACjB,GAAA,EAAD,CAASvL,MAAM,eAAKwL,UAAU,OAC5B,kBAAC,KAAD,QAGJ,kBAACW,GAAA,EAAD,CAAYvE,KAAK,SAASvE,QAAS,kBAAM,EAAKqJ,qBAC5C,kBAACnB,GAAA,EAAD,CAASvL,MAAM,eAAKwL,UAAU,OAC5B,kBAAC,KAAD,QAGJ,kBAACD,GAAA,EAAD,CAASvL,MAAM,eAAKwL,UAAU,OAC5B,kBAACmB,GAAA,EAAD,CAAUF,QAAS3M,KAAKY,MAAM2L,QAAStI,SAAU,SAAClB,GAAD,OAAO,EAAK+J,oBAAoB/J,c,GAxEpE5C,IAAMC,WAkF3B2M,GAAa,SAACC,GAClB,IAGIC,EAHEjC,EAAM3I,OAAOC,OAAO,GAAI0K,GACxB,YAAahC,IAAQA,EAAIkC,QAAU,IACzClC,EAAIkC,QAAQC,OAAS,mBAEf,qBAAsBnC,EAAIkC,QAI9BD,EAAQjC,EAAIkC,QAAQE,kBAHpBH,EAAQ,GACRjC,EAAIkC,QAAQE,iBAAmBH,GAUjC,IANA,IAMA,MAAqB5K,OAAOE,QANX,CACf8K,uBAAwB,GACxBC,eAAgB,KAChBC,aAAc,IACdC,eAAgB,MAElB,eAA+C,CAAC,IAAD,sBAAnC/K,EAAmC,KAAhCC,EAAgC,KACvCD,KAAKwK,IACTA,EAAMxK,GAAKC,GAMf,MAHM,UAAWsI,IAAQA,EAAIlI,MAAQ,IAC/B,SAAUkI,EAAIlI,QAAUkI,EAAIlI,MAAM2K,KAAO,IACzC,SAAUzC,EAAIlI,MAAM2K,OAASzC,EAAIlI,MAAM2K,KAAKC,KAAO,IAClD1C,GASH2C,GAA8B,SAAC1N,GACnC,IAAM+K,EAAM+B,GAAW9M,EAAMgL,UACzBgC,EAAQjC,EAAIkC,QAAQE,iBAFkC,EAGhCQ,mBAASX,EAAMI,uBAHiB,mBAGnD/L,EAHmD,KAG5CuM,EAH4C,KAW1D,OACE,oCACE,kBAAC/J,EAAA,EAAD,CAAYC,cAAY,GAAxB,4BAGA,kBAAC+J,GAAA,EAAD,CACExM,MAAOA,EACP2C,SAbe,SAAC7C,EAAYW,GAChCkL,EAAMI,sBAAwBtL,EAC9B8L,EAAS9L,GACT9B,EAAMiL,OAAOF,IAWT+C,KAAM,IACNC,IAAK,EACLC,kBAAkB,OAClBtK,kBAAgB,wBAMlBuK,GAAuB,SAACjO,GAC5B,IAAM+K,EAAM+B,GAAW9M,EAAMgL,UACzBgC,EAAQjC,EAAIkC,QAAQE,iBAF2B,EAGzBQ,mBAASO,KAAKC,MAAMnB,EAAMO,iBAHD,mBAG5ClM,EAH4C,KAGrCuM,EAHqC,KAgBnD,OACE,oCACE,kBAAC/J,EAAA,EAAD,CAAYC,cAAY,GAAxB,4BAGA,kBAAC+J,GAAA,EAAD,CACExM,MAAOA,EACP2C,SAlBe,SAAC7C,EAAYW,GAChC,IAAMsM,EAAM,SAAG,GAAKtM,GACpBkL,EAAMO,eAAiBa,EACvBR,EAAS9L,GACT9B,EAAMiL,OAAOF,IAeTsD,KAAM,GACNP,KAAM,EACNC,IAAK,EACLC,kBAAkB,OAClBM,iBAhBc,SAACjN,GACnB,MAAO,MAAQA,GAgBXqC,kBAAgB,wBAMlB6K,GAAeC,aAAW,CAC9BC,WAAY,CACVzJ,MAAO,UACP,YAAa,CACXA,MAAO,WAET,qBAAsB,CACpB0J,gBAAiB,YAGrBhC,QAAS,GACTiC,MAAO,IAXYH,CAYlBI,MAGGC,GAAgB,SAAC7O,GACrB,IAAM+K,EAAM+B,GAAW9M,EAAMgL,UADe,EAElB2C,mBAAS5C,EAAIkC,QAAQ6B,SAFH,mBAErCzN,EAFqC,KAE9BuM,EAF8B,KAW5C,OACE,oCACE,kBAAC/J,EAAA,EAAD,CAAYC,cAAY,GAAxB,4BAGA,kBAACyK,GAAD,CAAc7B,QAASrL,EAAO2C,SAZb,SAAC7C,GACpB,IAAMuL,EAAUvL,EAAMC,OAAOsL,QAC7B3B,EAAIkC,QAAQ6B,QAAUpC,EACtBkB,EAASlB,GACT1M,EAAMiL,OAAOF,IAQ2CvG,KAAK,mBAO3DuK,GAAwB,SAAC/O,GAC7B,IAAM+K,EAAM+B,GAAW9M,EAAMgL,UADuB,EAE1B2C,mBAAiC,IAAxB5C,EAAIlI,MAAM2K,KAAKC,MAFE,mBAE7CpM,EAF6C,KAEtCuM,EAFsC,KAgBpD,OACE,oCACE,kBAAC/J,EAAA,EAAD,CAAYC,cAAY,GAAxB,kCAGA,kBAACyK,GAAD,CAAc7B,QAASrL,EAAO2C,SAjBb,SAAC7C,GACpB,IAAMuL,EAAUvL,EAAMC,OAAOsL,QAE3B3B,EAAIlI,MAAM2K,KAAKC,KADbf,EACoB,EAEA,GAExBkB,EAASlB,GACT1M,EAAMiL,OAAOF,GACbnJ,QAAQC,IAAIkJ,IAQ4CvG,KAAK,2BAe3DwK,G,kDACJ,WAAYhP,GAAyB,IAAD,8BAClC,cAAMA,IACDW,MAAQ,CACXC,MAAM,GAH0B,E,8DAQlCb,KAAKiB,SAAS,CAACJ,MAAM,M,oCAIrBb,KAAKiB,SAAS,CAACJ,MAAM,M,+BAGb,IAAD,OACP,OACE,oCACE,kBAAC4K,GAAA,EAAD,CAASvL,MAAM,2BAAOwL,UAAU,OAC9B,kBAAC,KAAD,CAAUnI,QAAS,kBAAM,EAAKC,sBAEhC,kBAACC,EAAA,EAAD,CAAQ5C,KAAMb,KAAKY,MAAMC,KAAM6C,QAAS,WAAO,EAAKL,eAAgBM,kBAAgB,qBAClF,kBAACC,EAAA,EAAD,CAAanD,GAAG,qBAAhB,wCACA,kBAACoD,EAAA,EAAD,CAAepD,GAAG,cAChB,kBAAC,GAAD,CACEyK,OAAQlL,KAAKC,MAAMiL,OACnBD,OAAQjL,KAAKC,MAAMgL,SACrB,kBAAC,GAAD,CACEC,OAAQlL,KAAKC,MAAMiL,OACnBD,OAAQjL,KAAKC,MAAMgL,SACrB,kBAAC,GAAD,CACEC,OAAQlL,KAAKC,MAAMiL,OACnBD,OAAQjL,KAAKC,MAAMgL,SACrB,kBAAC,GAAD,CACEC,OAAQlL,KAAKC,MAAMiL,OACnBD,OAAQjL,KAAKC,MAAMgL,gB,GApCR9K,IAAMC,WA6CzB8O,GAAmB,SAACjP,GAMxB,OACE,kBAACkP,GAAA,EAAD,CACEC,QAAS,kBAACZ,GAAD,CAAc7B,QAAS1M,EAAMoP,YAAapL,SAPlC,SAAC7C,GACpB,IAAMuL,EAAUvL,EAAMC,OAAOsL,QAC7B1M,EAAMqP,UAAU3C,IAK6DlI,KAAK,oBAChFI,MAAM,2BACN0K,eAAe,WAOfC,GAAyB,SAACvP,GAM9B,OACE,kBAACkP,GAAA,EAAD,CACEC,QAAS,kBAACZ,GAAD,CAAc7B,QAAS1M,EAAMoP,YAAapL,SAPlC,SAAC7C,GACpB,IAAMuL,EAAUvL,EAAMC,OAAOsL,QAC7B1M,EAAMqP,UAAU3C,IAK6DlI,KAAK,0BAChFI,MAAM,6CACN0K,eAAe,WAiBfE,G,kDACJ,WAAYxP,GAA4B,IAAD,8BACrC,cAAMA,IACDW,MAAQ,CACXC,MAAM,GAH6B,E,8DAQrCb,KAAKiB,SAAS,CAACJ,MAAM,M,oCAIrBb,KAAKiB,SAAS,CAACJ,MAAM,M,+BAGb,IAAD,OACP,OACE,oCACE,kBAAC4K,GAAA,EAAD,CAASvL,MAAM,eAAKwL,UAAU,OAC5B,kBAAC,KAAD,CAAcnI,QAAS,kBAAM,EAAKC,sBAEpC,kBAACC,EAAA,EAAD,CAAQ5C,KAAMb,KAAKY,MAAMC,KAAM6C,QAAS,WAAO,EAAKL,eAAgBM,kBAAgB,qBAClF,kBAACC,EAAA,EAAD,CAAanD,GAAG,qBAAhB,gBACA,kBAACoD,EAAA,EAAD,CAAepD,GAAG,cAChB,kBAAC,GAAD,CACE4O,YAAarP,KAAKC,MAAMyP,iBACxBJ,UAAWtP,KAAKC,MAAM0P,sBAExB,kBAAC,GAAD,CACEN,YAAarP,KAAKC,MAAM2P,uBACxBN,UAAWtP,KAAKC,MAAM4P,mC,GA/BR1P,IAAMC,W,oDC7gBnB,YAACH,GACd,IAAM6P,EAAO7P,EAAM6P,KACbC,EAAM9P,EAAM8P,IACdC,EAAM/P,EAAMgQ,KAAKH,EAAKI,WACpBC,EAAa,CACjBC,IAAKL,EAAIM,EAAI,KACbrK,KAAM+J,EAAIO,EAAI,MAEVC,EAAW,UAAWP,EAAM,CAAC/K,MAAO+K,EAAI/K,OAAS,GACvD,OACE,kBAAC,KAAD,KACE,yBAAKnF,UAAU,YAAYuL,MAAO8E,GAChC,kBAAC,KAAD,CAAWrQ,UAAU,cAAcyD,QAAS,kBAAMtD,EAAMuQ,WACxD,yBAAK1Q,UAAU,WACb,yBAAK2Q,IAAM,UAAWX,EAAQA,EAAKY,MAAQ,GAAIC,IAAI,KACnD,yBAAK7Q,UAAU,SACb,yBAAKA,UAAU,QACZgQ,EAAKjL,OAER,yBAAK/E,UAAU,YAAYuL,MAAOkF,QACtBhH,IAARyG,EAAqBA,EAAInL,MAAQ,KAGvC,yBAAK/E,UAAU,YLnBH,SAAC8Q,EAAaC,GAClC,IAAIpP,EAAM,GAAKmP,EAKf,OAJIA,EAAI1P,OAAS2P,IACfpP,EAAMmP,EAAIE,MAAM,EAAGD,GACnBpP,GAAO,OAEFA,EKcKsP,CAAcjB,EAAK3M,KAAM,KAG1B,SAAU2M,GAA2B,KAAjBA,EAAI,KACzB,uBAAGhQ,UAAU,OAAOC,KAAM+P,EAAKkB,MAA/B,gBACA,S,oBCnCG,YAAC/Q,GACd,OAAIA,EAAMqB,OAAS,IACT,qCAGR,kBAAC2P,GAAA,EAAD,CAAKC,SAAS,WAAWC,QAAQ,eAC/B,kBAACC,GAAA,EAAqBnR,GACtB,kBAACgR,GAAA,EAAD,CACEb,IAAK,EACLpK,KAAM,EACNqL,OAAQ,EACRC,MAAO,EACPJ,SAAS,WACTC,QAAQ,OACRI,WAAW,SACXC,eAAe,UAEf,kBAAC1N,EAAA,EAAD,CAAYgB,QAAQ,UAAU2M,UAAU,MAAMxM,MAAM,iBAApD,UACMkJ,KAAKuD,MAAOzR,EAAMqB,OADxB,SCXFqQ,GAAY,kBAAM/I,SAASgJ,qBAAqB,UAAU,IAG1DC,GACO,UADPA,GAEa,EA+CbC,GAAc,SAAC7R,GAA6B,IAAD,EACH2N,oBAAS,GADN,mBACxCmE,EADwC,KACxBC,EADwB,KAE3CC,EAAY,IAiBVC,EAAe,WACNP,KACNtG,MAAM9C,OAAS0J,EAAY,MASpC,OACE,yBAAKnS,UAAU,eACb,kBAAC,GAAD,CAAckM,cAAe/L,EAAM+L,gBACnC,kBAAC,GAAD,CAAcQ,eAAgBvM,EAAMuM,eAAgBC,MAAOxM,EAAMwM,QACjE,kBAAChB,GAAA,EAAD,CAASvL,MAAM,eAAKwL,UAAU,OAAM,kBAAC,KAAD,CAAiBnI,QAAS,kBAAMtD,EAAMkS,iBAC1E,kBAAC,GAAD,CAAYjH,OAAQjL,EAAMiL,OAAQD,OAAQhL,EAAMgL,SAChD,kBAAC,GAAD,CAAmBC,OAAQjL,EAAMiL,OAAQD,OAAQhL,EAAMgL,SACvD,kBAAC,GAAD,CACEyE,iBAAkBzP,EAAMyP,iBACxBC,oBAAqB1P,EAAM0P,oBAC3BC,uBAAwB3P,EAAM2P,uBAC9BC,0BAA2B5P,EAAM4P,4BAElCkC,EACC,kBAACtG,GAAA,EAAD,CAASvL,MAAM,2BAAOwL,UAAU,OAAM,kBAAC,KAAD,CAAoBnI,QApBzC,WACrBqF,SAASwJ,iBACTF,IACAF,GAAkB,OAkBd,kBAACvG,GAAA,EAAD,CAASvL,MAAM,eAAKwL,UAAU,OAAM,kBAAC,KAAD,CAAgBnI,QAzClC,WACtB,IAAI8O,EAASV,KACTW,EAAa1J,SAASwC,eAAe,sBAC/B,OAAVkH,QAAU,IAAVA,KAAYC,oBACZN,EAAYI,EAAOG,aACnBH,EAAOhH,MAAM9C,OAASjI,OAAOmS,OAAOlK,OAAS,KAC7CyJ,GAAkB,GAClBpJ,SAASG,iBAAiB,oBAAoB,SAAC3H,GACvCwH,SAAS8J,oBACbR,IACAF,GAAkB,aAqCpBW,GAA0B,CAC9BC,YAAY,EACZjQ,MAAO,CACLkQ,MAAO,OAET3F,QAAS,CACP6B,SAAS,EACT+D,eAAe,EACf3F,OAAQ,mBACRC,iBAAkB,CAChBC,uBAAwB,GACxBC,eAAgB,KAChBC,aAAc,IACdC,eAAgB,MAGpB1K,MAAO,CACLwF,MAAO,GACPrD,MAAO,CACL8N,QAAS,OAGbC,YAAa,CACXC,iBAAiB,EACjBC,OAAO,EACPC,aAAa,IAwBIC,G,kDACnB,WAAYnT,GAAsB,IAAD,8BAC/B,cAAMA,IACDW,MAAQ,CACXyS,UAAW,KACXC,aAAc,EACd5D,kBAAkB,EAClB6D,OAAQpT,IAAMqT,YACdC,WAAY,KACZC,SAAUzT,EAAMkD,KAAKxB,KAAKgB,MAC1BiN,wBAAwB,GATK,E,sEAaP+D,GACxB,IAAMC,EAAW5T,KAAKY,MAAMgP,wBACV,IAAbgE,IAA8B,IAAPD,EAC1B3T,KAAK6T,cACiB,IAAbD,IAA+B,IAAPD,GACjC3T,KAAK8T,oBAEP9T,KAAKiB,SAAS,CACZ2O,uBAAwB+D,M,kCAIfhP,GAAc,IAAD,OAElBoP,EADW/T,KAAKY,MAAM2S,OAAOS,QAAuBC,QAClCC,UAAUvP,EAAOwP,QAAQC,KAC3CC,EAAkC,qBAAZN,EAC5BlS,QAAQC,IAAIiS,GACZ,IAAMhE,EAAa,CAACO,EAAG,GAAID,EAAG,IAExBiE,EAAe,WACnB,IAAIxE,EAAO,EAAK7P,MAAMkD,KAAKxB,KAAKgB,MAAM4R,MAAK,SAAC1R,GAAD,OAAQA,EAAEpC,KAAOsT,KAC5D,OAAO,kBAACS,GAAD,CAAWzE,IAAKA,EAAKD,KAAMA,EAChBG,KAAM,EAAKhQ,MAAMkD,KAAKX,WACtBgO,MAAO,kBAAO,EAAKvP,SAAS,CAACoS,UAAW,WAGxDoB,EAAQzU,KAAKY,MAAMyS,UACnBgB,GAA0B,OAAVI,GAAmBzU,KAAKY,MAAM8O,kBAEvC2E,GAA0B,OAAVI,GAAmBzU,KAAKY,MAAM8O,iBADvD1P,KAAKiB,SAAS,CAACoS,UAAWiB,MAGP,OAAVG,GACTzU,KAAKiB,SAAS,CAACoS,UAAW,S,mCAIjB1O,GACL3E,KAAKY,MAAMgP,yBACIjL,EAAOhC,MAAMzB,OAAS,EAEzClB,KAAK8T,oBAEL9T,KAAK6T,gB,kCAIGlP,GACV3E,KAAK0U,YAAY/P,GACjB3E,KAAK2U,aAAahQ,K,0CAGAgP,GAClB3T,KAAKiB,SAAS,CACZyO,iBAAkBiE,M,oCAIRrP,GACGtE,KAAKY,MAAM2S,OAAOS,QAAuBC,QAChDW,WAAWtQ,GACnBtE,KAAKiB,SAAS,CAACwS,WAAYnP,M,sCAI3B,OAAOtE,KAAKY,MAAM6S,a,0CAIlBzT,KAAK6U,cAAclC,IACnB3S,KAAK8U,oB,sCAGU,IAAD,OACV3R,EAAOnD,KAAKC,MAAMkD,KAUtB,OARE,oCACCnD,KAAK+U,mBACN,kBAAC,WAAD,CAAStM,IAAKzI,KAAKY,MAAM2S,OAAQhQ,QAAS,SAACoB,GAAiB,EAAKqQ,YAAYrQ,KAC1ExB,EAAKxB,KAAKgB,MAAM0C,KAAI,SAAAxC,GAAC,OA3OX,SAACA,EAAaoS,GAC/B,IACIhQ,EADA+K,EAAMiF,EAAUpS,EAAEqN,WAOtB,OAJEjL,EADE+K,EACMA,EAAI/K,MAEJ4M,GAGR,kBAAC,QAAD,CAAM5F,IAAKpJ,EAAEpC,GACXA,GAAIoC,EAAEpC,GAAIoE,MAAOhC,EAAEgC,MACnBgO,MAAM,gBACNnC,MAAO7N,EAAE6N,MACTzL,MAAOA,EACPiQ,YAAarD,KA6NesD,CAAWtS,EAAGM,EAAKX,eAC5CW,EAAKxB,KAAKmB,MAAMuC,KAAI,SAACtC,GAAD,OAzNV,SAACA,GAClB,IAAIqS,EAAS,GAEb,MADK,cAAerS,IAA0B,IAAnBA,EAAC,YAA2BqS,EAAS,MAE9D,kBAAC,QAAD,CAAMnJ,IAAKlJ,EAAEtC,GAAIA,GAAIsC,EAAEtC,GAAI2U,OAAQA,EAC7BnP,KAAMlD,EAAEkD,KAAMC,GAAInD,EAAEmD,GAAIrB,MAAO9B,EAAE8B,QAoNPwQ,CAAWtS,U,yCAQ3C,OACE,yBAAKtC,GAAG,eACN,kBAAC,GAAD,CAAkBqE,QAAQ,cAAcxD,MAAiC,IAA1BtB,KAAKY,MAAM0S,kB,wCAO9D,IAAMgC,EAAOtV,KACPyI,EAAOzI,KAAKY,MAAM2S,OAAOS,QAAuBC,QACtDxL,EAAIkL,GAAG,yBAAyB,SAAUhP,GACxC,IAAM4Q,EAAQ5Q,EAAO6Q,WAAa7Q,EAAO8Q,MACzCH,EAAKrU,SAAS,CAACqS,aAAciC,OAE/B9M,EAAIiN,KAAK,+BAA+B,WACtCJ,EAAKrU,SAAS,CAACqS,aAAc,S,mCAK/B,IAAMjB,EAASV,KAGTgE,EAAUtD,EAAOuD,WAAW,MAClB,OAAZD,IACFA,EAAQE,OACRF,EAAQG,yBAA2B,mBACnCH,EAAQI,UAAY,UACpBJ,EAAQK,SAAS,EAAG,EAAG3D,EAAO/J,MAAO+J,EAAO9J,QAC5CoN,EAAQM,WAGV,IACMjU,EADMqQ,EAAO6D,UAAU,YAAa,GAC1BjP,QAAQ,oBAAqB,iCACzCsD,EAAI3B,SAASC,cAAc,KAC/B0B,EAAEC,SAAW,cACbD,EAAExK,KAAOiC,EACTuI,EAAElJ,OAAS,SACXuH,SAAS8B,KAAKC,YAAYJ,GAC1BA,EAAEX,QACFhB,SAAS8B,KAAKE,YAAYL,K,yCAGTwB,GACjB,IAAMpJ,EAAQ3C,KAAKC,MAAMoH,WAAW0E,GAAG,GACvC,KAAIpJ,EAAMzB,QAAU,GAApB,CACA,IAAM+S,EAAWjU,KAAKY,MAAM2S,OAAOS,QAAuBC,QAC1DA,EAAQkC,YAAY,IACpB,IAAMC,EAAWzT,EAAM0C,KAAI,SAAAxC,GAAC,OAAIwT,OAAOxT,EAAEpC,OACrCkC,EAAMzB,OAAS,EACjB+S,EAAQqC,IAAI,CAAC3T,MAAOyT,EAAUG,WAAW,IAEzCtC,EAAQuC,MAAMJ,EAAS,GAAI,CAACK,MAAO,EAAGF,WAAW,IAEnDtC,EAAQkC,YAAYC,M,0CAGFrK,EAAUQ,GAC5B,IAAM5J,EAAQ3C,KAAKC,MAAMoH,WAAW0E,EAAGQ,GACvCvM,KAAKC,MAAMyW,SAAS/T,K,mCAIpB3C,KAAKC,MAAMyW,SAAS1W,KAAKY,MAAM8S,Y,2CAI/B,IADmB,EACbO,EAAWjU,KAAKY,MAAM2S,OAAOS,QAAuBC,QACpDjT,EAAWiT,EAAQ0C,mBACrBC,EAAuB,IAAIC,IAHZ,cAID7V,GAJC,IAInB,2BAA4B,CAAC,IAAlB8V,EAAiB,QAC1BF,EAAQG,IAAKC,SAASX,OAAOS,KAC7B,IAF0B,EAEpBG,EAAYhD,EAAQiD,kBAAkBJ,GAFlB,cAGNG,GAHM,IAG1B,2BAA4C,CAAC,IAAlCE,EAAiC,QAC1CP,EAAQG,IAAKC,SAASX,OAAOc,MAJL,gCAJT,8BAWnB,OAAOP,I,0CAIP5W,KAAK6T,aACL,IAFkB,EAEZ+C,EAAU5W,KAAKoX,qBACjBzU,EAAQ,GAHM,cAIF3C,KAAKY,MAAM8S,UAJT,IAIlB,2BAAqC,CAAC,IAA3B7Q,EAA0B,QAC/B+T,EAAQS,IAAIxU,EAAEpC,KAChBkC,EAAMM,KAAKJ,IANG,8BASlB7C,KAAKC,MAAMyW,SAAS/T,K,+BAIpB,OACE,yBAAK7C,UAAU,WACb,yBAAKA,UAAU,cAAcW,GAAG,sBAC7BT,KAAKsX,gBACLtX,KAAKY,MAAMyS,UACZ,kBAAC,GAAD,CACEnI,OAAQlL,KAAK6U,cAAcxM,KAAKrI,MAChCiL,OAAQjL,KAAKuX,cAAclP,KAAKrI,MAChCmS,WAAYnS,KAAKmS,WAAW9J,KAAKrI,MACjCgM,cAAehM,KAAKwX,mBAAmBnP,KAAKrI,MAC5CwM,eAAgBxM,KAAKyX,oBAAoBpP,KAAKrI,MAC9CyM,MAAOzM,KAAK6T,WAAWxL,KAAKrI,MAC5B0P,iBAAkB1P,KAAKY,MAAM8O,iBAC7BC,oBAAqB3P,KAAK2P,oBAAoBtH,KAAKrI,MACnD4P,uBAAwB5P,KAAKY,MAAMgP,uBACnCC,0BAA2B7P,KAAK6P,0BAA0BxH,KAAKrI,c,GAlNtCG,IAAMC,W,oBC5JrCsX,GAAYC,cAAW,SAACxP,GAAD,OAC3ByP,aAAa,CACXC,KAAM,CACJvP,MAAO,KAETwP,OAAQ,CACNvP,OAAQJ,EAAM4P,QAAQ,SAWb,YAAC9X,GACd,GAAIA,EAAM+X,WAAW9W,OAAS,EAAK,OAAQ,qCAC3C,IAAM+W,EAAUP,KAEZQ,GAAK,EACHC,EAAQlY,EAAM+X,WAAW3S,KAAI,SAAA+S,GAEjC,MAAO,CACL9W,MAFF4W,GAAK,EAGHrT,MAAOuT,EAAEvT,UASb,OACE,yBAAK/E,UAAWmY,EAAQJ,KAAK,eACzB,yBAAK/X,UAAU,SAAf,sBACA,yBAAKA,UAAU,UACb,kBAACgO,GAAA,EAAD,CACEuK,aAAcpY,EAAMqY,KACpB3U,kBAAgB,yBAChBoK,IAAK,EACLC,IAAK/N,EAAM+X,WAAW9W,OAAO,EAC7BoN,KAAM,KACNL,kBAAkB,MAClBkK,MAAOA,EACPlU,SAjBW,SAAC7C,EAAYW,GAChC,IAAMqW,EAAIrW,EACV9B,EAAMsY,QAAQH,S,oJC+CZI,GAAoB,CACxBzB,IA7CgB,SAAC,GAAD,IAAG0B,EAAH,EAAGA,UAAH,OAChB,yBAAKpN,MAAO,CAAEqN,UAAW,WACvB,kBAAC1T,EAAA,EAAD,CACEC,MAAM,UACN1B,QAASkV,EACTvY,MAAM,kBAHR,SA4CFyY,KAlCiB,SAAC,GAAD,IAAGF,EAAH,EAAGA,UAAH,OACjB,kBAACpM,GAAA,EAAD,CAAY9I,QAASkV,EAAWvY,MAAM,YACpC,kBAAC,KAAD,QAiCF0Y,OA7BmB,SAAC,GAAD,IAAGH,EAAH,EAAGA,UAAH,OACnB,kBAACpM,GAAA,EAAD,CACE9I,QAAS,WAEHjD,OAAOuY,QAAQ,8CACjBJ,KAGJvY,MAAM,cAEN,kBAAC,KAAD,QAoBF4Y,OAhBmB,SAAC,GAAD,IAAGL,EAAH,EAAGA,UAAH,OACnB,kBAACpM,GAAA,EAAD,CAAY9I,QAASkV,EAAWvY,MAAM,gBACpC,kBAAC,KAAD,QAeF6Y,OAXmB,SAAC,GAAD,IAAGN,EAAH,EAAGA,UAAH,OACnB,kBAACpM,GAAA,EAAD,CAAYpH,MAAM,YAAY1B,QAASkV,EAAWvY,MAAM,kBACtD,kBAAC,KAAD,SAYE8Y,GAAU,SAAC,GAAuB,IAArBvY,EAAoB,EAApBA,GAAIgY,EAAgB,EAAhBA,UACfQ,EAAgBT,GAAkB/X,GACxC,OACE,kBAACwY,EAAD,CACER,UAAWA,KAKXS,GAAkB,CACtBhJ,UAAW,CAAC,SAAU,gBACtBtJ,UAAW,CAAC,OAAQ,UA6BTuS,GAAiB1K,cA3Gf,SAAAtG,GAAK,MAAK,CACvBiR,eAAgB,CACdC,QAASlR,EAAM4P,QAAQ,IAEzBuB,OAAQ,CACNhR,MAAO,qBAETiR,UAAW,CACTjR,MAAO,QAETkR,WAAY,CACVtI,SAAU,0BAgGmC,CAAEzM,KAAM,sBAA3BgK,EA1BH,SAAC,GAAD,IACzBgL,EADyB,EACzBA,sBAAuBnY,EADE,EACFA,MAAOoY,EADL,EACKA,cAAezB,EADpB,EACoBA,QADpB,OAGzB,kBAAC0B,GAAA,EAAD,CACE7Z,UAAWmY,EAAQmB,gBAEnB,kBAACQ,GAAA,EAAD,CACEtY,MAAOA,EACP2C,SAAU,SAAA7C,GAAK,OAAIsY,EAActY,EAAMC,OAAOC,QAC9CuY,UAAW,CACT/Z,UAAWmY,EAAQuB,YAErBM,MACE,kBAACC,GAAA,EAAD,CACE9B,QAAS,CAAEJ,KAAMI,EAAQsB,cAI5BE,EAAsBpU,KAAI,SAAAb,GAAI,OAC7B,kBAACwV,GAAA,EAAD,CAAU/N,IAAKzH,EAAMlD,MAAOkD,GACzBA,WAQLyV,GAAW,SAACha,GAAW,IACnBia,EAAWja,EAAXia,OACFT,EAAwBP,GAAgBgB,EAAOzV,MACrD,OAAIgV,EACK,kBAACN,GAAD,iBAAoBlZ,EAApB,CAA2BwZ,sBAAuBA,KAEpD,kBAAC,KAAaU,KAASla,IAG1Bma,GAAW,SAAAC,GAAG,OAAIA,EAAI5Z,IAKtB6Z,GAAa,SAACC,EAAQC,EAAgBC,EAAUC,EAAUC,EAAYC,GAqJ1E,OArJ6F,kDAI3F,WAAY3a,GAAQ,IAAD,8BACjB,cAAMA,IACDW,MAAQ,CACXia,QAASN,EACT5O,KAAiC,oBAAnB6O,EAAiCA,EAAeva,GAASA,EAAMua,GAC7EM,sBAAuBL,EACvBM,QAAS,GACTC,cAAe,GACfC,UAAW,GACXC,WAAY,GACZC,YAAa,EACbC,SAAU,EACVC,UAAW,CAAC,EAAG,GAAI,GACnBC,YAAaZ,EACba,iBAAkB,CAACC,KAAgBC,aACnCC,kBAAmB,IAfJ,EAJwE,4DAuB3Epa,GAEd,IADA,IAAIqa,EAAa,GACjB,MAAqBtZ,OAAOE,QAAQoY,GAApC,eAAiD,CAAC,IAAD,sBAArClY,EAAqC,KAAlCC,EAAkC,KAE7CiZ,EAAWlZ,GADI,oBAANC,EACOA,EAAE1C,KAAKY,MAAM+K,MAEbjJ,EAGpBb,QAAQC,IAAI6Z,GACZ3b,KAAKiB,SAAS,CACZga,UAAW3Z,EAAM+D,KAAI,SAAAgV,GAAG,OAAKhY,OAAOuZ,KAAKvB,GAAKnZ,OAASmZ,EAAMsB,SAlC0B,iCAsChFE,GACT,IAAMC,EAAgB9b,KAAKY,MAAM+K,KAAKmF,QAOtC,OANA+K,EAAWE,SAAQ,SAACC,GAClB,IAAMC,EAAQH,EAAcI,WAAU,SAAA7B,GAAG,OAAIA,EAAI5Z,KAAOub,KACpDC,GAAS,GACXH,EAAcK,OAAOF,EAAO,MAGzBH,IA9CkF,uCAiD/C,IAEtCM,EAFUC,EAA2B,EAA3BA,MAAOC,EAAoB,EAApBA,QAASC,EAAW,EAAXA,QACxB5Q,EAAO3L,KAAKY,MAAM+K,KAExB,GAAI0Q,EAAO,CACT,IAAMG,EAAkB7Q,EAAKzK,OAAS,EAAIyK,EAAKA,EAAKzK,OAAS,GAAGT,GAAK,EAAI,EACzE2b,EAAW,uBACNzQ,GADM,aAEN0Q,EAAMhX,KAAI,SAACgV,EAAK4B,GAAN,qBACXxb,GAAI+b,EAAkBP,GACnB5B,QAILiC,IACFF,EAAczQ,EAAKtG,KAAI,SAAAgV,GAAG,OAAKiC,EAAQjC,EAAI5Z,IAAZ,6BAAuB4Z,GAAQiC,EAAQjC,EAAI5Z,KAAQ4Z,MAEhFkC,IACFH,EAAcpc,KAAKyc,WAAWF,IAEhCvc,KAAKiB,SAAS,CACZ0K,KAAMyQ,IAGRxB,EAAe5a,KAAKC,MAAOmc,KAxE8D,gDA+EnEM,GACxB,IAAMC,EAAqC,oBAAnBnC,EAAiCA,EAAekC,GAAaA,EAAUlC,GAC/Fxa,KAAKiB,SAAS,CAAE0K,KAAMgR,MAjFqE,+BAoFnF,IAAD,OACP,OACE,kBAACC,GAAA,EAAD,KACE,kBAAC,KAAD,CACEjR,KAAM3L,KAAKY,MAAM+K,KACjBkP,QAAS7a,KAAKY,MAAMia,QACpBT,SAAUA,IAEV,kBAAC,KAAD,CACEW,QAAS/a,KAAKY,MAAMma,QACpB8B,gBAAiB,SAACvX,GAAO,EAAKrE,SAAS,CAAC8Z,QAASzV,OAEnD,kBAAC,KAAD,CACE6V,YAAanb,KAAKY,MAAMua,YACxB2B,oBAAqB,SAACC,GAAD,OAAO,EAAK9b,SAAS,CAACka,YAAa4B,KACxD3B,SAAUpb,KAAKY,MAAMwa,SACrB4B,iBAAkB,SAAC1X,GAAD,OAAO,EAAKrE,SAAS,CAACma,SAAU9V,OAEpD,kBAAC,KAAD,CACE0V,cAAehb,KAAKY,MAAMoa,cAC1BiC,sBAAuB,SAACC,GAAS,EAAKjc,SAAS,CAAC+Z,cAAekC,KAC/DhC,WAAYlb,KAAKY,MAAMsa,WACvBiC,mBAAoB,SAACJ,GAAO,EAAK9b,SAAS,CAACia,WAAY6B,KACvD9B,UAAWjb,KAAKY,MAAMqa,UACtBmC,kBAAmBpd,KAAKqd,gBAAgBhV,KAAKrI,MAC7Csd,gBAAiBtd,KAAKud,cAAclV,KAAKrI,QAE3C,kBAAC,KAAD,CACEwd,WAAYxd,KAAKY,MAAM8a,oBAGzB,kBAAC,KAAD,MACA,kBAAC,KAAD,MAEA,kBAAC,KAAD,CACE+B,iBAAkBzd,KAAKY,MAAMka,wBAE/B,kBAAC,KAAD,CACE4C,MAAO1d,KAAKY,MAAM0a,YAClBqC,cAAe,SAACZ,GAAD,OAAO,EAAK9b,SAAS,CAACqa,YAAayB,OAEpD,kBAAC,KAAD,CAAgBa,qBAAmB,IACnC,kBAAC,KAAD,CACEC,cAAe5D,KAEjB,kBAAC,KAAD,CACE3R,MAAO,IACPwV,gBAAiB9d,KAAKY,MAAMqa,UAAU/Z,OACtC6c,iBAAe,EACfC,mBAAiB,EACjBC,iBAAkBjF,KAEpB,kBAAC,KAAD,CACEkF,YAAale,KAAKY,MAAM2a,mBAE1B,kBAAC,KAAD,CACEF,UAAWrb,KAAKY,MAAMya,kBA5I6D,GAEvElb,IAAMC,YAuJxB+d,GAAW7D,GACf,CACE,CAAE7V,KAAM,KAAMvE,MAAO,MACrB,CAAEuE,KAAM,QAASvE,MAAO,gBACxB,CAAEuE,KAAM,YAAavE,MAAO,gBAC5B,CAAEuE,KAAM,OAAQvE,MAAO,gBACvB,CAAEuE,KAAM,QAASvE,MAAO,gBACxB,CAAEuE,KAAM,OAAQvE,MAAO,iBAEzB,QACA,CACE,CAAEke,WAAY,KAAM9V,MAAO,IAC3B,CAAE8V,WAAY,QAAS9V,MAAO,KAC9B,CAAE8V,WAAY,YAAa9V,MAAO,KAClC,CAAE8V,WAAY,OAAQ9V,MAAO,KAC7B,CAAE8V,WAAY,QAAS9V,MAAO,KAC9B,CAAE8V,WAAY,OAAQ9V,MAAO,MAE/B,CAAC,KAAM,QAAS,YAAa,OAAQ,QAAS,QAC9C,CACE7H,GAAI,SAACkL,GAAD,OAAWA,EAAKzK,OAAS,EAAKiN,KAAKH,IAAL,MAAAG,KAAI,aAAQxC,EAAKtG,KAAI,SAACgZ,GAAD,OAAOA,EAAE5d,QAAO,EAAI,GAC3EoE,MAAO,GACPqL,UAAWgJ,GAAgBhJ,UAAU,GACrC/M,KAAM,GACNuN,MAAO,GACPM,KAAM,KAER,SAAC/Q,EAAOmc,GAAiBnc,EAAMyW,SAAS0F,EAAY/W,KAAI,SAACgZ,GAAO,OAAO,6BAAIA,GAAX,IAAc5d,GAAIuW,SAASX,OAAOgI,EAAE5d,cAgBhG6d,GAAWhE,GACf,CACE,CAAE7V,KAAM,KAAMvE,MAAO,MACrB,CAAEuE,KAAM,OAAQvE,MAAO,QACvB,CAAEuE,KAAM,KAAMvE,MAAO,MACrB,CAAEuE,KAAM,QAASvE,MAAO,gBACxB,CAAEuE,KAAM,YAAavE,MAAO,wBAE9B,SAACD,GAAD,OAAqBA,EAAM6C,MArBMuC,KAAI,SAACkZ,GACtC,IAAIxb,EAAIV,OAAOC,OAAO,GAAIic,GAE1B,OADAxb,EAAE6D,UAAYyP,OAAOtT,EAAE6D,WAChB7D,OAmBP,CACE,CAAEqb,WAAY,KAAM9V,MAAO,KAC3B,CAAE8V,WAAY,OAAQ9V,MAAO,KAC7B,CAAE8V,WAAY,KAAM9V,MAAO,KAC3B,CAAE8V,WAAY,QAAS9V,MAAO,KAC9B,CAAE8V,WAAY,YAAa9V,MAAO,MAEpC,CAAC,KAAM,OAAQ,KAAM,QAAS,aAC9B,CACE7H,GAAI,SAACkL,GAAD,OAAWA,EAAKzK,OAAS,EAAKiN,KAAKH,IAAL,MAAAG,KAAI,aAAQxC,EAAKtG,KAAI,SAACgZ,GAAD,OAAOA,EAAE5d,QAAO,EAAI,GAC3EoE,MAAO,GACP+B,UAAWsS,GAAgBtS,UAAU,GACrCzD,KAAM,GACNuN,MAAO,GACPM,KAAM,KAER,SAAC/Q,EAAOmc,GAAiBnc,EAAMue,SAAsBpC,EAhCnB/W,KAAI,SAACkZ,GACvC,IAAIxb,EAAIV,OAAOC,OAAO,GAAIic,GAG1B,OAFAxb,EAAEtC,GAAKuW,SAASX,OAAOtT,EAAEtC,KACzBsC,EAAE6D,UAA6B,UAAhB7D,EAAE6D,UACV7D,SAkDH0b,GAAUnE,GACd,CACE,CAAE7V,KAAM,KAAMvE,MAAO,MACrB,CAAEuE,KAAM,QAASvE,MAAO,gBACxB,CAAEuE,KAAM,QAASvE,MAAO,kBAE1B,SAACD,GACC,IAAMgQ,EAAOhQ,EAAMgQ,KAEnB,OADAiJ,GAAgBhJ,UAAY7N,OAAOuZ,KAAK3L,GA3B3B,SAACA,GAEhB,IADA,IAAItE,EAAO,GACX,MAAqBtJ,OAAOE,QAAQ0N,GAApC,eAA2C,CAAC,IAAD,sBAA/BxN,EAA+B,KAA5BC,EAA4B,KACrC2X,EAAMhY,OAAOC,OAAO,CAAC7B,GAAIgC,GAAIC,GACjCiJ,EAAK1I,KAAKoX,GAEZ,OAAO1O,EAsBE+S,CAASzO,KAElB,CACE,CAAEmO,WAAY,KAAM9V,MAAO,KAC3B,CAAE8V,WAAY,QAAS9V,MAAO,KAC9B,CAAE8V,WAAY,QAAS9V,MAAO,MAEhC,CAAC,KAAM,QAAS,SAChB,CACE7H,GAAI,GACJoE,MAAO,GACPI,MAAO,YAET,SAAChF,EAAOmc,GACNlD,GAAgBhJ,UAAYkM,EAAY/W,KAAI,SAACgZ,GAAD,OAAOA,EAAE5d,MACrDR,EAAM0e,QAlCU,SAAChT,GACnB,IAD4B,EACxBsE,EAAO,GADiB,cAEZtE,GAFY,IAE5B,2BAAsB,CAAC,IAAZ0S,EAAW,QAChB3b,EAAIL,OAAOC,OAAO,GAAI+b,UACnB3b,EAAEjC,GACTwP,EAAKoO,EAAE5d,IAAMiC,GALa,8BAO5B,OAAOuN,EA2BS2O,CAAYxC,O,kDCpZTyC,G,kLAGf,IAAIC,EAASlW,SAASC,cAAc,UAChCkW,EAASnW,SAASwC,eAAe,iCACtB,OAAX2T,IACFD,EAAOhW,aAAa,MAAO,iCAC3BgW,EAAOhW,aAAa,cAAe,aACnCgW,EAAOhW,aAAa,QAAS,QAC7BgW,EAAOhW,aAAa,OAAQ,2CAC5BgW,EAAOhW,aAAa,aAAc9I,KAAKC,MAAM+e,WAC7CF,EAAOhW,aAAc,QAAS,gBAC9BiW,EAAOpU,YAAYmU,M,+BAKvB,OACI,oCACE,yBAAKhf,UAAU,YAEf,kBAACmf,GAAA,EAAD,KACE,kBAACC,GAAA,EAAD,CACEC,WAAY,kBAAC,KAAD,MACZC,gBAAc,mBAEd,kBAACtb,EAAA,EAAD,4BAEF,kBAACub,GAAA,EAAD,CAAkB5e,GAAG,oBACnB,yBAAKA,GAAG,0C,GA7BgBL,aCoNvBkf,G,kDA3Lb,WAAYrf,GAAsB,IAAD,8BAC/B,cAAMA,IACDW,MAAQ,CACXgB,MAAO,KACP2d,UAAU,EACVC,UAAW,GACXC,YAAa,EACbzH,WAAY,GACZ0H,UAAW,IARkB,E,gEAYZ,IAAD,OACdlb,EAAOxE,KAAKC,MAAMuE,KAClBmb,EAA+B,GACX,kBAAbnb,EAAKxC,IACd2d,EAAW1c,KAAK,CAAC4B,MAAO,SAAU7C,IAAKwC,EAAKxC,MAE5C2d,EAAanb,EAAKxC,IAEpBhC,KAAKiB,SAAS,CAACue,UAAW,IAAII,MAAMD,EAAWze,UAC/C2e,QAAQC,IACNH,EAAWta,KAAI,SAAC+S,GAAD,OAAO7W,MAAM6W,EAAEpW,KAAKR,MAAK,SAAAue,GAAI,OAAIA,EAAKre,cAEtDF,MAAM,SAAAwe,GACL,IAAMC,EAAQD,EACd,EAAK/e,SAAS,CACZse,UAAU,EACVC,UAAWS,EAAM5a,KAAI,SAAAlC,GAAI,OAtDV,SAACA,GACtB,IADyC,EACrC+c,EAA6B,GADQ,cAE3B/c,EAAKxB,KAAKgB,OAFiB,IAEzC,2BAA+B,CAAC,IAAvBE,EAAsB,QAC7BA,EAAEpC,GAAKuW,SAASX,OAAOxT,EAAEpC,KACzByf,EAAUjd,KAAKJ,IAJwB,8BAOzC,OADAM,EAAKxB,KAAKgB,MAAQud,EACX/c,EA+C4Bgd,CAAehd,MAC5C6U,WAAY2H,EACZD,UAAWO,EAAM5a,KAAI,SAAAlC,GACnB,IAD2B,EACvBid,EAAkC,GADX,cAEXjd,EAAKxB,KAAKgB,OAFC,IAE3B,2BAAiC,CAAC,IAAvBE,EAAsB,QAC/Bud,EAAMvd,EAAEpC,IAAMoC,GAHW,8BAK3B,OAAOud,UAIb,SAACxe,GACC,EAAKX,SAAS,CACZse,UAAU,EACV3d,e,+BAKGe,GACP,IAAI0d,EAAQrgB,KAAKY,MAAM4e,UACnBrc,EAAOkd,EAAMrgB,KAAKY,MAAM6e,aACf,OAATtc,IACFA,EAAKxB,KAAKgB,MAAQA,EAClB3C,KAAKiB,SAAS,CAACue,UAAWa,O,+BAIrBvd,GACP,IAAIud,EAAQrgB,KAAKY,MAAM4e,UACnBrc,EAAOkd,EAAMrgB,KAAKY,MAAM6e,aACf,OAATtc,IACFA,EAAKxB,KAAKmB,MAAQA,EAClB9C,KAAKiB,SAAS,CAACue,UAAWa,O,oCAIhB7d,GACZ,IAAI6d,EAAQrgB,KAAKY,MAAM4e,UACnBrc,EAAOkd,EAAMrgB,KAAKY,MAAM6e,aAChB,MAARtc,IACFA,EAAKX,WAAaA,EAClBxC,KAAKiB,SAAS,CAACue,UAAWa,O,8BAItBld,GACN,IAAIkd,EAAQrgB,KAAKY,MAAM4e,UACvBa,EAAMrgB,KAAKY,MAAM6e,aAAetc,EAChCnD,KAAKiB,SAAS,CAACue,UAAWa,M,qCAGbjI,GACbpY,KAAKiB,SAAS,CAACwe,YAAarH,M,iCAGnBrM,GAAoC,IAA1BQ,EAAyB,wDACxC+T,EAAa,QACbC,EAAa,GACXxf,EAAQgL,EAAEjF,MAAM,KACtB,GAAqB,IAAjB/F,EAAMG,OACRqf,EAAaxf,EAAM,OACd,IAAqB,IAAjBA,EAAMG,OAIf,MAAO,GAHPof,EAAavf,EAAM,GACnBwf,EAAaxf,EAAM,GAAGyf,OAIxB,IAAI/e,EAAM,GAEJ4e,EAAQrgB,KAAKY,MAAM4e,UACnBrc,EAAOkd,EAAMrgB,KAAKY,MAAM6e,aACxBC,EAAY1f,KAAKY,MAAM8e,UAAU1f,KAAKY,MAAM6e,aAC5C9c,EAAQQ,EAAKxB,KAAKgB,MAClB8d,EAAS,SAACC,GAAD,OAAmBnU,GAAYmU,EAAQA,GACtD,IACE,GAAmB,OAAfJ,EAAqB,CACvB,IAAMzd,EAAI6c,EAAU1I,SAASuJ,SACnBhX,IAAN1G,GACFpB,EAAIwB,KAAKJ,OAEN,CACL,IADK,EACC8d,EAAU,IAAIC,OAAOL,GADtB,cAES5d,GAFT,IAEL,2BAAqB,CAAC,IAAbE,EAAY,QACnB,GAAMyd,KAAczd,EAApB,CACA,IAAMge,EAAOhe,EAAUyd,GACnBG,EAAOE,EAAQG,KAAKzK,OAAOwK,MAC7Bpf,EAAIwB,KAAKJ,KANR,+BAUP,OAAOpB,EACP,MAAMsB,GAEN,OADAlB,QAAQC,IAAIiB,GACL,M,+BAKT,IAAIyB,EAAOxE,KAAKC,MAAMuE,KADf,EAE6CxE,KAAKY,MAAjDgB,EAFD,EAECA,MAAO2d,EAFR,EAEQA,SAAUC,EAFlB,EAEkBA,UAAWC,EAF7B,EAE6BA,YACpC,GAAI7d,EACF,OAAO,uCAAaA,EAAMmf,SACrB,GAAKxB,EAEL,CACL,IAAMpc,EAAOqc,EAAUC,GACvB,OACE,6BACE,kBAAC,EAAD,CAAQvf,MAAOsE,EAAKC,OACpB,yBAAK3E,UAAU,aACf,kBAAC,EAAD,CACEqD,KAAMA,EACNC,QAASpD,KAAKoD,QAAQiF,KAAKrI,MAC3BqH,WAAYrH,KAAKqH,WAAWgB,KAAKrI,QAEnC,yBAAKF,UAAU,QACb,kBAAC,IAAD,KACE,kBAAC,IAAD,KACE,kBAAC,IAAD,iCACA,kBAAC,IAAD,4BACA,kBAAC,IAAD,sBACA,kBAAC,IAAD,kCAEF,kBAAC,IAAD,CAAUkhB,aAAa,GACrB,kBAAC,GAAD,CACE7d,KAAMA,EACNuT,SAAU1W,KAAK0W,SAASrO,KAAKrI,MAC7BqH,WAAYrH,KAAKqH,WAAWgB,KAAKrI,SAGrC,kBAAC,IAAD,CAAUghB,aAAa,GACrB,kBAAC7C,GAAD,CAAUxb,MAAOQ,EAAKxB,KAAKgB,MAAO+T,SAAU1W,KAAK0W,SAASrO,KAAKrI,SAEjE,kBAAC,IAAD,CAAUghB,aAAa,GACrB,kBAAC1C,GAAD,CAAUxb,MAAOK,EAAKxB,KAAKmB,MAAO0b,SAAUxe,KAAKwe,SAASnW,KAAKrI,SAEjE,kBAAC,IAAD,CAAUghB,aAAa,GACrB,kBAACvC,GAAD,CAASxO,KAAM9M,EAAKX,WAAYmc,QAAS3e,KAAKihB,cAAc5Y,KAAKrI,WAKvE,kBAACkhB,GAAD,CACE5I,KAAMtY,KAAKY,MAAM6e,YACjBzH,WAAYhY,KAAKY,MAAMoX,WACvBO,QAASvY,KAAKmhB,eAAe9Y,KAAKrI,QAGpC,kBAAC,GAAD,CAAUgf,UAAWxa,EAAKC,QAG1B,kBAAC,EAAD,OAhDJ,OAAO,+C,GArIStE,IAAMC,W,oDC3BtBghB,G,uKAUM,IAAD,EACqBphB,KAAKC,MAAzBohB,EADD,EACCA,SAAU/f,EADX,EACWA,MAClB,OACE,kBAAC,KAAD,CAAmB+f,SAAUA,GAC1B/f,O,GAdeggB,iBAAlBF,GAMGG,aAAe,CACpBF,SAAU,MAaCD,UCdMI,I,yDACnB,WAAYvhB,GAAsB,IAAD,8BAC/B,cAAMA,IACDW,MAAQ,CACXgB,MAAO,KACP2d,UAAU,EACV/Y,QAAS,MALoB,E,gEASZ,IAAD,OACZxE,EAAMhC,KAAKC,MAAMa,UACvBS,MAAMS,GACHR,MAAK,SAAAC,GAAG,OAAIA,EAAIggB,UAChBjgB,MAAK,SAACG,GACL,EAAKV,SAAS,CACZse,UAAU,EACV/Y,QAAS7E,OAGb,SAACC,GACC,EAAKX,SAAS,CACZse,UAAU,EACV3d,e,+BAKE,IAAD,EAC8B5B,KAAKY,MAAlCgB,EADD,EACCA,MAAO2d,EADR,EACQA,SAAU/Y,EADlB,EACkBA,QACzB,OAAI5E,EACK,uCAAaA,EAAMmf,SAChBxB,EAIR,oCACE,kBAAC,EAAD,CAAQrf,MAAOF,KAAKC,MAAMC,QAC1B,yBAAKJ,UAAU,aACb,yBAAKA,UAAU,OACb,kBAAC,KAAD,CACE4hB,OAAQlb,EACRmb,UAAW,CAAEC,KAAMR,IACnBS,YAAY,MAIlB,kBAAC,EAAD,OAdG,+C,GAjCwB1hB,IAAMC,YCDrC0hB,G,uKAEF,IAAItd,EAAOxE,KAAKC,MAAMuE,KACtB,OACE,uBAAGzE,KAAM,aAAayE,EAAKC,MAC3B,yBAAK3E,UAAU,QACb,yBAAKA,UAAU,WAAW2Q,IAAKjM,EAAKud,SAAUpR,IAAKnM,EAAKC,OACxD,uBAAG3E,UAAU,QAAQ0E,EAAKC,Y,GAPftE,IAAMC,WAcnB4hB,G,uKAEF,IAAIxd,EAAOxE,KAAKC,MAAMuE,KACtB,OACI,yBAAK1E,UAAU,OAAOW,GAAG,WACvB,uBAAGV,KAAM,aAAayE,EAAKC,MACzB,kBAACgH,GAAA,EAAD,CAASvL,MAAM,iCAAQwL,UAAU,OAC/B,kBAACW,GAAA,EAAD,CAAYvE,KAAK,SAASrH,GAAG,iBAC3B,kBAAC,KAAD,CAAsBA,GAAG,wB,GARnBN,IAAMC,WAqBtB6hB,G,uKAEF,IAAMlhB,EAAQf,KAAKC,MAAMc,MACzB,OACE,yBAAKjB,UAAU,SACZiB,EAAMsE,KAAI,SAAAb,GAAI,MACE,6BAAdA,EAAKC,KACJ,kBAAC,GAAD,CAASwH,IAAKzH,EAAKC,KAAMD,KAAMA,IAC/B,kBAAC,GAAD,CAAMyH,IAAKzH,EAAKC,KAAMD,KAAMA,Y,GARpBrE,IAAMC,WAmBpB8hB,G,uKAEF,IAAInhB,EAAQf,KAAKC,MAAMc,MACvB,OACE,yBAAKjB,UAAU,OACb,kBAAC,EAAD,CAAQI,MAAM,kDACd,yBAAKJ,UAAU,YACb,yBAAKA,UAAU,aACb,kBAAC,GAAD,CAAOiB,MAAOA,MAGlB,kBAAC,EAAD,W,GAXWZ,IAAMC,WA8EV+hB,G,kDArDb,WAAYliB,GAAkB,IAAD,8BAC3B,cAAMA,IACDW,MAAQ,CACXgB,MAAO,KACP2d,UAAU,EACVxe,MAAO,IALkB,E,gEASR,IAAD,OAClBQ,MAAM,iBACHC,MAAK,SAAAC,GAAG,OAAIA,EAAIC,UAChBF,MAAK,SAACG,GACL,EAAKV,SAAS,CACZse,UAAU,EACVxe,MAAOY,OAGX,SAACC,GACC,EAAKX,SAAS,CACZse,UAAU,EACV3d,e,+BAKE,IAAD,EAC0B5B,KAAKY,MAAhCgB,EADC,EACDA,MAAO2d,EADN,EACMA,SAAUxe,EADhB,EACgBA,MAGvB,OADAA,EAAQA,EAAM6B,OAAO,CADH,CAAC6B,KAAM,2BAAQsd,SAAU,GAAI/f,IAAK,qBAEhDJ,EACK,uCAAaA,EAAMmf,SAChBxB,EAIR,kBAAC,IAAD,CAAQ6C,SAAS,KACf,kBAAC,IAAD,CAAOnW,IAAI,OAAOoW,OAAK,EAACC,KAAK,IAAI7Q,UAAW,kBAAM,kBAAC,GAAD,CAAM1Q,MAAOA,OAC9DA,EAAMsE,KAAI,SAAAb,GAAI,OACb,kBAAC,IAAD,CAAOyH,IAAKzH,EAAKC,KAAM6d,KAAM,YAAY9d,EAAKC,KACvCgN,UAAW,kBAAM,kBAAC,GAAD,CAASjN,KAAMA,UAEzC,kBAAC,IAAD,CAAOyH,IAAI,aAAaqW,KAAM,cACvB7Q,UAAW,kBAAM,kBAAC,GAAD,CAASvR,MAAM,2BAAOY,UAAW,0BACzD,kBAAC,IAAD,CAAOmL,IAAI,QAAQqW,KAAM,SAClB7Q,UAAW,kBAAM,kBAAC,GAAD,CAASvR,MAAM,eAAKY,UAAW,sBAZpD,+C,GAlCKX,IAAMC,WCrFJmiB,QACW,cAA7BjiB,OAAOC,SAASiiB,UAEe,UAA7BliB,OAAOC,SAASiiB,UAEhBliB,OAAOC,SAASiiB,SAASC,MACvB,2DCbNC,IAASC,OACP,kBAAC,IAAMC,WAAP,KACE,kBAAC,GAAD,OAEFha,SAASwC,eAAe,SDkIpB,kBAAmBpB,WACrBA,UAAU6Y,cAAcC,MACrBthB,MAAK,SAAAuhB,GACJA,EAAaC,gBAEdC,OAAM,SAAArhB,GACLC,QAAQD,MAAMA,EAAMmf,c","file":"static/js/main.77a5f791.chunk.js","sourcesContent":["import React from 'react'\r\n\r\ntype HeaderProps = {\r\n  title: string;\r\n}\r\n\r\nexport default class Header extends React.Component<HeaderProps, object> {\r\n  render() {\r\n    return (\r\n      <header>\r\n        <div className=\"page-title\">\r\n          <div className=\"container\">\r\n            <div className=\"topbar\">\r\n              <div className=\"links\">\r\n                <a href=\"#/contribute\">\r\n                  如何贡献\r\n                </a>\r\n                <a href=\"#/about\">\r\n                  关于\r\n                </a>\r\n                <a href=\"https://github.com/AniNet-Project\">\r\n                  GitHub\r\n                </a>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div className=\"container title\">\r\n            <p className=\"sub\">\r\n              <a href=\"/\">\r\n                AniNet\r\n              </a>\r\n            </p>\r\n            <h1>{this.props.title}</h1>\r\n          </div>\r\n        </div>\r\n      </header>\r\n    )\r\n  }\r\n}\r\n","import React from 'react'\r\nimport GitHubIcon from '@material-ui/icons/GitHub';\r\nimport EmailIcon from '@material-ui/icons/Email';\r\n\r\n\r\nconst Busuanzi = () => {\r\n  const isHome = window.location.href.endsWith('#/')\r\n  if (isHome) {\r\n    return (\r\n      <div className=\"busuanzi\">\r\n        <span id=\"busuanzi_container_site_pv\"> 本站总访问量<span id=\"busuanzi_value_site_pv\"></span>次 </span>\r\n      </div>\r\n    )\r\n  } else {\r\n    return (\r\n      <></>\r\n    )\r\n  }\r\n}\r\n\r\n\r\nexport default class Footer extends React.Component<object, object> {\r\n  render() {\r\n    return (\r\n      <div className=\"footer\">\r\n        <div className=\"container\">\r\n          <a href=\"https://github.com/AniNet-Project\">\r\n            <GitHubIcon/>\r\n          </a>\r\n          <a href=\"mailto:nanguage@yahoo.com\">\r\n            <EmailIcon id=\"email-icon\"/>\r\n          </a>\r\n\r\n          <Busuanzi/>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n","import React from 'react'\nimport Button from '@material-ui/core/Button';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport InputBase from '@material-ui/core/InputBase';\nimport Typography from '@material-ui/core/Typography';\nimport Autocomplete from '@material-ui/lab/Autocomplete';\nimport TextField from '@material-ui/core/TextField';\n\n\nimport { mergeInfo } from './utils'\nimport { SourceItem, ItemInfo } from './datatypes'\n\n\ntype setInfoMth = (info: ItemInfo) => void\n\ntype ImportDialogProps = {\n  setInfo: setInfoMth,\n  info: ItemInfo,\n}\ntype ImportDialogState = {\n  open: boolean,\n  sourceUrl: string,\n  items: Array<SourceItem>,\n  selected: null | SourceItem\n}\n\n\nexport default class ImportDialog extends React.Component<ImportDialogProps, ImportDialogState> {\n\n  constructor(props: ImportDialogProps) {\n    super(props)\n    this.state = {\n      open: false,\n      sourceUrl: \"https://raw.githubusercontent.com/AniNet-Project/crawler/master/data/bgm.json\",\n      items: [],\n      selected: null,\n    }\n  }\n\n  handleClickOpen() {\n    this.setState({open: true})\n    if (this.state.items.length === 0) {\n      this.loadSource()\n    }\n  };\n\n  handleClose() {\n    this.setState({open: false})\n  };\n\n  sourceChanged(event: any) {\n    this.setState({\n      sourceUrl: event.target.value\n    })\n    this.loadSource()\n  }\n\n  loadSource() {\n    fetch(this.state.sourceUrl)\n      .then(res => res.json())\n      .then(data => {\n        this.setState({\n          items: data.data\n        })\n      },\n      (error) => {\n        console.log(error)\n        this.setState({\n          items: []\n        })\n      })\n  }\n\n  onSelectedChange(event: any, newValue: SourceItem | null) {\n    this.setState({\n      selected: newValue\n    })\n  }\n\n  loadItem() {\n    if (this.state.selected === null) {return}\n    const url = this.state.selected.data\n    fetch(url)\n      .then(res => res.json())\n      .then(data => {\n        const newInfo = mergeInfo(this.props.info, data)\n        this.props.setInfo(newInfo)\n      },\n      (error) => {\n        console.log(error)\n      })\n    this.handleClose()\n  }\n\n  handleClickConfirm() {\n    this.loadItem()\n  }\n\n  render() {\n    return (\n      <>\n        <button onClick={() => this.handleClickOpen()}>导入预定义数据</button>\n        <Dialog open={this.state.open} onClose={() => {this.handleClose()}} aria-labelledby=\"form-dialog-title\">\n          <DialogTitle id=\"form-dialog-title\">从数据源导入</DialogTitle>\n\n          <DialogContent id=\"importDialog\">\n            <Typography gutterBottom>\n              数据源\n            </Typography>\n            <InputBase\n              value={this.state.sourceUrl}\n              onChange={(e) => this.sourceChanged(e)}\n              placeholder=\"请输入数据源索引文件 URL\"\n            />\n            <Typography gutterBottom>\n              条目\n            </Typography>\n            <Autocomplete\n              value={this.state.selected}\n              onChange={(e, n) => {this.onSelectedChange(e, n)}}\n              id=\"import-items-filter\"\n              options={this.state.items}\n              getOptionLabel={(item: SourceItem) => item.name}\n              renderInput={(params: any) => <TextField {...params} label=\"筛选\" variant=\"outlined\" />}\n            />\n\n            <DialogActions>\n              <Button onClick={() => {this.handleClose()}} color=\"primary\">\n                取消\n              </Button>\n              <Button onClick={() => {this.handleClickConfirm()}} color=\"primary\">\n                确定\n              </Button>\n            </DialogActions>\n          </DialogContent>\n        </Dialog>\n      </>\n    )\n  }\n\n}\n\n","import { ItemInfo, NodeType, EdgeType } from \"./datatypes\";\r\n\r\nconst exportToJson = (objectData: any, fileName: string) => {\r\n  let contentType = \"application/json;charset=utf-8;\";\r\n  if (window.navigator && window.navigator.msSaveOrOpenBlob) {\r\n    var blob = new Blob([decodeURIComponent(encodeURI(JSON.stringify(objectData)))], { type: contentType });\r\n    navigator.msSaveOrOpenBlob(blob, fileName);\r\n  } else {\r\n    var a = document.createElement('a');\r\n    a.download = fileName;\r\n    a.href = 'data:' + contentType + ',' + encodeURIComponent(JSON.stringify(objectData, null, 2));\r\n    a.target = '_blank';\r\n    document.body.appendChild(a);\r\n    a.click();\r\n    document.body.removeChild(a);\r\n  }\r\n}\r\n\r\n\r\nconst shorterString = (str: string, limit: number) => {\r\n  let res = \"\" + str\r\n  if (str.length > limit) {\r\n    res = str.slice(0, limit) \r\n    res += \"...\"\r\n  }\r\n  return res\r\n}\r\n\r\nconst mergeInfo = (info_a: ItemInfo, info_b: ItemInfo) => {\r\n  let new_ = Object.assign({}, info_a)\r\n  for (const [k, v] of Object.entries(info_b.categories)) {\r\n    new_.categories[k] = v\r\n  }\r\n  let nodes: Record<number, NodeType> = {} \r\n  for (const n of info_a.data.nodes.concat(info_b.data.nodes)) {\r\n    nodes[n.id] = n;\r\n  }\r\n  let edges: Record<number, EdgeType> = {} \r\n  for (const e of info_a.data.edges.concat(info_b.data.edges)) {\r\n    edges[e.id] = e;\r\n  }\r\n  new_.data.nodes = []\r\n  for (const n of Object.values(nodes)) {new_.data.nodes.push(n)}\r\n  new_.data.edges = []\r\n  for (const e of Object.values(edges)) {new_.data.edges.push(e)}\r\n  return new_\r\n}\r\n\r\n\r\nexport {exportToJson, shorterString, mergeInfo}\r\n","/*\nImplement the Parser of a Simple Edge Markup Language(SEML).\n\nThe synatax like these:\n\n1. For undirected edges:\n\nDio-敌人-承太郎\n花京院-朋友-承太郎\n\n2. For directed edges:\n\n乔瑟夫-祖父->承太郎\n承太郎<-父亲-徐伦\n\n3. explicit query type:\n\n(id:1)-朋友-(id:2)\n\n*/\n\nimport * as P from 'parsimmon'\n\n\ntype QueryHint = string\nexport type QueryEdge = {\n  label: string,\n  from: QueryHint,\n  to: QueryHint,\n  directed: boolean,\n}\n\nconst symbols = /[a-zA-Z0-9\\u4e00-\\u9fa5]+/\n\nconst Label: P.Parser<QueryHint> =\n  P.regexp(symbols)\n   .map(s => s)\n\nconst ExplicitLabel: P.Parser<QueryHint> =\n  P.seq(P.string(\"(label:\"), Label, P.string(\")\"))\n   .map(\n     ([_l, label, _r]) => label\n   )\n\nconst ExplicitID: P.Parser<QueryHint> =\n  P.seq(P.string(\"(id:\"), P.regex(/[0-9]+/), P.string(\")\"))\n   .map(\n     ([_l, id, _r]) => \"id:\"+id\n   )\n\nconst Obj: P.Parser<QueryHint> =\n  P.alt(\n    ExplicitLabel,\n    ExplicitID,\n    Label,\n  )\n\n\nconst dash = P.regex(/-+/)\nconst rightArrow = P.seq(dash, P.string(\">\"))\nconst leftArrow = P.seq(P.string(\"<\"), dash)\n\n\nconst EdgeLabel = P.alt(\n\n  P.seq(\n    P.string(\"(\"),\n    P.alt(Label, P.string(\"\")),\n    P.string(\")\"))\n  .map(([_l, l, _r]) => l),\n\n  Label,\n)\n\n\nconst UndirectedEdge: P.Parser<QueryEdge> = \n  P.seq(Obj, dash, EdgeLabel, dash, Obj)\n   .map(\n     ([left, _1, label, _2, right]) => {\n       return {\n         label: label,\n         from: left,\n         to: right,\n         directed: false\n       }\n     }\n   )\n\nconst DirectedRightEdge: P.Parser<QueryEdge> = \n  P.seq(Obj, dash, EdgeLabel, rightArrow, Obj)\n   .map(\n     ([left, _1, label, _2, right]) => {\n       return {\n         label: label,\n         from: left,\n         to: right,\n         directed: true\n       }\n     }\n   )\n\nconst DirectedLeftEdge: P.Parser<QueryEdge> = \n  P.seq(Obj, leftArrow, EdgeLabel, dash, Obj)\n   .map(\n     ([left, _1, label, _2, right]) => {\n       return {\n         label: label,\n         from: right,\n         to: left,\n         directed: true\n       }\n     }\n   )\n\nconst LineParser: P.Parser<QueryEdge> =\n  P.seq(\n    P.regex(/[ \\t]*/),\n    P.alt(\n      UndirectedEdge,\n      DirectedLeftEdge,\n      DirectedRightEdge,\n    ),\n    P.regex(/[ \\t]*/),\n  )\n  .map(\n    ([_l, e, _r]) => e\n  )\n\nexport {LineParser}\n","import React from 'react'\nimport Button from '@material-ui/core/Button';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogContentText from '@material-ui/core/DialogContentText';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport AceEditor from \"react-ace\";\n\nimport \"ace-builds/src-noconflict/mode-java\";\nimport \"ace-builds/src-noconflict/theme-github\";\n\n\nimport { ItemInfo, NodeType } from './datatypes'\nimport { LineParser } from './edgeMarkup'\n\ntype Props = {\n  info: ItemInfo,\n  setInfo: (info:ItemInfo) => void,\n  queryNodes: (q: string, reverse: boolean) => Array<NodeType>\n}\ntype State = {\n  open: boolean,\n  content: string,\n  markers: Array<any>,\n}\n\nexport default class EdgeMarkDialog extends React.Component<Props, State> {\n  constructor(props: Props) {\n    super(props)\n    this.state = {\n      open: false,\n      content: \"\",\n      markers: [],\n    }\n  }\n\n  handleClickOpen() {\n    this.setText()\n    this.setState({open: true})\n  };\n\n  handleClose() {\n    this.setState({open: false})\n  };\n\n  textChanged(newValue: any) {\n    this.setState({\n      content: newValue\n    })\n  }\n\n  setText() {\n    let texts = \"\"\n    for (const e of this.props.info.data.edges) {\n      texts += \"(id:\" + e.from + \")\" +\n               \"--\" + e.label + (e.direction == false ? \"--\" : \"-->\" ) +\n               \"(id:\" + e.to + \")\\n\"\n    }\n    this.setState({\n      content: texts\n    })\n  }\n\n  processLines() {\n    const lines = this.state.content.split(/\\r?\\n/)\n    let edges = []\n    let markers = []\n    let idx = 0\n    for (const line of lines) {\n      if (line.replace(/^\\s+|\\s+$/g, '').length === 0) {\n        continue\n      }\n      const res = LineParser.parse(line)\n      if (res.status === true) {\n        const e = res.value\n        // query from\n        const nodes_from = this.props.queryNodes(e.from, false)\n        const nodes_to = this.props.queryNodes(e.to, false)\n        if ((nodes_from.length >= 1) && (nodes_to.length >= 1)) {\n          const n_from = nodes_from[0]\n          const n_to = nodes_to[0]\n          const edge = {\n            id: idx,\n            from: n_from.id,\n            to: n_to.id,\n            label: e.label,\n            direction: e.directed,\n          }\n          edges.push(edge)\n        } else {\n          // query error\n          markers.push({\n            startRow: idx,\n            endRow: idx,\n            startCol: 0,\n            endCol: line.length,\n            className: 'mark-query-error',\n            type: \"text\",\n          })\n        }\n      } else {\n        // syntax error\n        markers.push({\n          startRow: idx,\n          endRow: idx,\n          startCol: 0,\n          endCol: line.length,\n          className: 'mark-syntax-error',\n          type: \"text\",\n        })\n      }\n      idx += 1;\n    }\n    let info = Object.assign({}, this.props.info)\n    info.data.edges = edges\n    this.props.setInfo(info)\n    this.setState({\n      markers: markers\n    })\n  }\n\n  handleClickConfirm() {\n    try {\n      this.processLines()\n    } catch(err) {\n      console.log(err)\n    }\n  }\n\n  render() {\n    return (\n      <div className=\"EditOptionsDialog\">\n        <button onClick={() => this.handleClickOpen()}>描述边(Edges)</button>\n        <Dialog open={this.state.open} onClose={() => {this.handleClose()}} aria-labelledby=\"form-dialog-title\">\n          <DialogTitle id=\"form-dialog-title\">描述边(Edges)</DialogTitle>\n          <DialogContent>\n            <DialogContentText>\n              通过简单的标记语言对边进行描述, 语法见<a>帮助</a>\n            </DialogContentText>\n            <p id=\"edit-edgemark-tips\"> </p>\n            <AceEditor\n              value={this.state.content}\n              mode=\"text\"\n              theme=\"github\"\n              onChange={this.textChanged.bind(this)}\n              width=\"550px\"\n              height=\"400px\"\n              fontSize={20}\n              markers={this.state.markers}\n              ref='aceEditor'\n            />\n          </DialogContent>\n          <DialogActions>\n            <Button onClick={() => {this.handleClose()}} color=\"primary\">\n              取消\n            </Button>\n            <Button onClick={() => {this.handleClickConfirm()}} color=\"primary\">\n              确定\n            </Button>\n          </DialogActions>\n        </Dialog>\n      </div>\n    );\n  }\n}\n","import React from 'react'\r\n\r\nimport { exportToJson } from './utils'\r\nimport ImportDialog from './ImportDialog'\r\nimport EdgeMarkDialog from './EdgeMarkDialog'\r\nimport { ItemInfo, NodeType } from './datatypes'\r\n\r\ntype setInfoMth = (info: ItemInfo) => void\r\n\r\nconst buildFileSelector = (setInfo: setInfoMth) => {\r\n  const fileSelector = document.createElement('input');\r\n  fileSelector.setAttribute('type', 'file');\r\n  fileSelector.setAttribute('multiple', 'multiple');\r\n  fileSelector.setAttribute('accept', '.json')\r\n  fileSelector.addEventListener('change', (event) => {\r\n    const target = event.target as HTMLInputElement\r\n    let file: File = (target.files as FileList)[0]\r\n    let reader = new FileReader()\r\n    reader.onload = () => {\r\n      setInfo(JSON.parse(reader.result as string))\r\n    }\r\n    if (file !== undefined) {\r\n      reader.readAsText(file)\r\n    }\r\n  })\r\n  return fileSelector;\r\n}\r\n\r\ntype UploadBtnProps = {\r\n  setInfo: setInfoMth\r\n}\r\n\r\ntype UploadBtnState = {\r\n  fileSelector: HTMLInputElement,\r\n}\r\n\r\nclass UploadBtn extends React.Component<UploadBtnProps, UploadBtnState> {\r\n  componentDidMount(){\r\n    this.setState({\r\n      fileSelector: buildFileSelector(this.props.setInfo)\r\n    })\r\n  }\r\n  \r\n  handleFileSelect = (e: React.MouseEvent) => {\r\n    e.preventDefault();\r\n    this.state.fileSelector.click();\r\n  }\r\n  \r\n  render(){\r\n    return <button onClick={this.handleFileSelect}>打开文件</button>\r\n  }\r\n}\r\n\r\ntype ToolBarProps = {\r\n  info: ItemInfo,\r\n  setInfo: setInfoMth,\r\n  queryNodes: (q: string, reverse: boolean) => Array<NodeType>\r\n}\r\n\r\n\r\nexport default class ToolBar extends React.Component<ToolBarProps, object> {\r\n  render() {\r\n    return (\r\n      <div className=\"toolbar\">\r\n        <div className=\"rightside\">\r\n          <ImportDialog info={this.props.info} setInfo={this.props.setInfo}/>\r\n          <EdgeMarkDialog info={this.props.info} setInfo={this.props.setInfo} queryNodes={this.props.queryNodes} />\r\n          <UploadBtn setInfo={this.props.setInfo}/>\r\n          <button onClick={() => {exportToJson(this.props.info, \"export.json\")}}>保存文件</button>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n","import React, {useState} from 'react'\r\nimport EditIcon from '@material-ui/icons/Edit';\r\nimport Tooltip from '@material-ui/core/Tooltip';\r\nimport Button from '@material-ui/core/Button';\r\nimport Dialog from '@material-ui/core/Dialog';\r\nimport DialogActions from '@material-ui/core/DialogActions';\r\nimport DialogContent from '@material-ui/core/DialogContent';\r\nimport DialogContentText from '@material-ui/core/DialogContentText';\r\nimport DialogTitle from '@material-ui/core/DialogTitle';\r\nimport SearchIcon from '@material-ui/icons/Search';\r\nimport InputBase from '@material-ui/core/InputBase';\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport FilterListIcon from '@material-ui/icons/FilterList';\r\nimport AutorenewIcon from '@material-ui/icons/Autorenew';\r\nimport Checkbox from '@material-ui/core/Checkbox';\r\nimport TuneIcon from '@material-ui/icons/Tune';\r\nimport Slider from '@material-ui/core/Slider';\r\nimport Typography from '@material-ui/core/Typography';\r\nimport Switch from '@material-ui/core/Switch';\r\nimport { withStyles } from '@material-ui/core/styles';\r\nimport SettingsIcon from '@material-ui/icons/Settings';\r\nimport FormControlLabel from '@material-ui/core/FormControlLabel';\r\n\r\n\r\ntype EditOptionsDialogProps = {\r\n  setOpt: (opt: any) => void,\r\n  getOpt: () => any,\r\n}\r\ntype EditOptionsDialogState = {\r\n  open: boolean,\r\n  content: string,\r\n}\r\n\r\nclass EditOptionsDialog extends React.Component<EditOptionsDialogProps, EditOptionsDialogState> {\r\n  constructor(props: EditOptionsDialogProps) {\r\n    super(props)\r\n    this.state = {\r\n      open: false,\r\n      content: \"\"\r\n    }\r\n  }\r\n\r\n  handleClickOpen() {\r\n    this.setState({open: true})\r\n    this.setTextArea()\r\n  };\r\n\r\n  handleClose() {\r\n    this.setState({open: false})\r\n  };\r\n\r\n  setTextArea() {\r\n    let opt = this.props.getOpt()\r\n    let content = JSON.stringify(opt, null, 2)\r\n    this.setState({content: content})\r\n  }\r\n\r\n  textChanged(event: any) {\r\n    this.setState({\r\n      content: event.target.value\r\n    })\r\n  }\r\n\r\n  handleClickConfirm() {\r\n    let options;\r\n    try {\r\n      options = JSON.parse(this.state.content)\r\n      this.props.setOpt(options)\r\n      this.setState({open: false})\r\n    } catch(err) {\r\n      console.log(err)\r\n      let ta = document.getElementById(\"edit-options-content\")\r\n      if (ta !== null) {\r\n        ta.style.border = \"2px solid #ff3333\"\r\n      }\r\n      let tip = document.getElementById(\"edit-options-tips\")\r\n      console.log(tip)\r\n      if (tip !== null) {\r\n        tip.innerHTML = \"JSON 解析失败，请检查。\"\r\n        tip.style.color = \"#ff3333\"\r\n        tip.style.fontSize = \"10px\"\r\n      }\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"EditOptionsDialog\">\r\n        <Tooltip title=\"编辑视图配置\" placement=\"top\">\r\n          <EditIcon onClick={() => {this.handleClickOpen()}}/>\r\n        </Tooltip>\r\n        <Dialog open={this.state.open} onClose={() => {this.handleClose()}} aria-labelledby=\"form-dialog-title\">\r\n          <DialogTitle id=\"form-dialog-title\">编辑网络视图配置</DialogTitle>\r\n          <DialogContent>\r\n            <DialogContentText>\r\n              直接通过 JSON 对网络视图进行配置，可配置项目细节可以参考\r\n              <a href=\"https://visjs.github.io/vis-network/docs/network/\">vis-network 文档</a> 。\r\n            </DialogContentText>\r\n            <p id=\"edit-options-tips\"> </p>\r\n            <textarea id=\"edit-options-content\"\r\n              rows={18} cols={72}\r\n              value={this.state.content}\r\n              onChange={(e) => {this.textChanged(e)}}\r\n              />\r\n          </DialogContent>\r\n          <DialogActions>\r\n            <Button onClick={() => {this.handleClose()}} color=\"primary\">\r\n              取消\r\n            </Button>\r\n            <Button onClick={() => {this.handleClickConfirm()}} color=\"primary\">\r\n              确定\r\n            </Button>\r\n          </DialogActions>\r\n        </Dialog>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\n\r\ntype SearchDialogProps = {\r\n  queryAndFocus: (q: string) => void,\r\n}\r\ntype SearchDialogState = {\r\n  open: boolean,\r\n  queryText: string,\r\n}\r\n\r\nclass SearchDialog extends React.Component<SearchDialogProps, SearchDialogState> {\r\n  constructor(props: SearchDialogProps) {\r\n    super(props)\r\n    this.state = {\r\n      open: false,\r\n      queryText: \"\",\r\n    }\r\n  }\r\n\r\n  handleClickOpen() {\r\n    this.setState({open: true})\r\n  };\r\n\r\n  handleClose() {\r\n    this.setState({open: false})\r\n  };\r\n\r\n  handleClickSearch() {\r\n    const q = this.state.queryText\r\n    this.props.queryAndFocus(q)\r\n    this.setState({open: false, queryText: \"\"})\r\n  }\r\n\r\n  textChanged(event: any) {\r\n    this.setState({\r\n      queryText: event.target.value\r\n    })\r\n  }\r\n\r\n  handlePressEnter(event: any) {\r\n    if (event.key === \"Enter\") {\r\n      this.handleClickSearch()\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <>\r\n        <Tooltip title=\"搜索\" placement=\"top\">\r\n          <SearchIcon onClick={() => this.handleClickOpen()}/>\r\n        </Tooltip>\r\n        <Dialog open={this.state.open} onClose={() => {this.handleClose()}} aria-labelledby=\"form-dialog-title\">\r\n          <DialogContent id=\"searchDialog\">\r\n            <InputBase\r\n              value={this.state.queryText}\r\n              onChange={(e) => this.textChanged(e)}\r\n              onKeyPress={(e) => this.handlePressEnter(e)}\r\n              placeholder=\"输入节点标签（如，label:苍崎青子）或ID（如，id:1）\"\r\n            />\r\n            <IconButton type=\"submit\" onClick={() => this.handleClickSearch()} >\r\n              <SearchIcon/>\r\n            </IconButton>\r\n          </DialogContent>\r\n        </Dialog>\r\n      </>\r\n    )\r\n  }\r\n}\r\n\r\n\r\ntype FilterDialogProps = {\r\n  queryAndFilter: (q: string, reverse: boolean) => void,\r\n  reset: () => void,\r\n}\r\ntype FilterDialogState = {\r\n  open: boolean,\r\n  queryText: string,\r\n  reverse: boolean,\r\n}\r\n\r\nclass FilterDialog extends React.Component<FilterDialogProps, FilterDialogState> {\r\n  constructor(props: FilterDialogProps) {\r\n    super(props)\r\n    this.state = {\r\n      open: false,\r\n      queryText: \"\",\r\n      reverse: true,\r\n    }\r\n  }\r\n\r\n  handleClickOpen() {\r\n    this.setState({open: true})\r\n  };\r\n\r\n  handleClose() {\r\n    this.setState({open: false})\r\n  };\r\n\r\n  handleClickFilter() {\r\n    const q = this.state.queryText\r\n    this.props.queryAndFilter(q, this.state.reverse)\r\n    this.setState({open: false, queryText: \"\"})\r\n  }\r\n\r\n  handleClickReset() {\r\n      this.props.reset()\r\n      this.setState({open: false, queryText: \"\"})\r\n  }\r\n\r\n  textChanged(event: any) {\r\n    this.setState({\r\n      queryText: event.target.value\r\n    })\r\n  }\r\n\r\n  handlePressEnter(event: any) {\r\n    if (event.key === \"Enter\") {\r\n      this.handleClickFilter()\r\n    }\r\n  }\r\n\r\n  handleChangeReverse(event: any) {\r\n    this.setState({\r\n      reverse: event.target.checked\r\n    })\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <>\r\n        <Tooltip title=\"筛选\" placement=\"top\">\r\n          <FilterListIcon onClick={() => this.handleClickOpen()}/>\r\n        </Tooltip>\r\n        <Dialog open={this.state.open} onClose={() => {this.handleClose()}} aria-labelledby=\"form-dialog-title\">\r\n          <DialogContent id=\"filterDialog\">\r\n            <InputBase\r\n              value={this.state.queryText}\r\n              onChange={(e) => this.textChanged(e)}\r\n              onKeyPress={(e) => this.handlePressEnter(e)}\r\n              placeholder=\"用于筛选的属性和正则表达式（如：categorie:person）\"\r\n            />\r\n            <IconButton type=\"submit\" onClick={() => this.handleClickFilter()} >\r\n              <Tooltip title=\"筛选\" placement=\"top\">\r\n                <FilterListIcon/>\r\n              </Tooltip>\r\n            </IconButton>\r\n            <IconButton type=\"submit\" onClick={() => this.handleClickReset()} >\r\n              <Tooltip title=\"重置\" placement=\"top\">\r\n                <AutorenewIcon/>\r\n              </Tooltip>\r\n            </IconButton>\r\n            <Tooltip title=\"反选\" placement=\"top\">\r\n              <Checkbox checked={this.state.reverse} onChange={(e) => this.handleChangeReverse(e)}/>\r\n            </Tooltip>\r\n          </DialogContent>\r\n        </Dialog>\r\n      </>\r\n    )\r\n  }\r\n}\r\n\r\n\r\nconst defaultOpt = (oldOpt: any) => {\r\n  const opt = Object.assign({}, oldOpt)\r\n  if (!(\"physics\" in opt)) { opt.physics = {} }\r\n  opt.physics.solver = \"forceAtlas2Based\"\r\n  let atlas;\r\n  if (!(\"forceAtlas2Based\" in opt.physics)) {\r\n    atlas = {}\r\n    opt.physics.forceAtlas2Based = atlas\r\n  } else {\r\n    atlas = opt.physics.forceAtlas2Based\r\n  }\r\n  const defaults = {\r\n    gravitationalConstant: -20,\r\n    centralGravity: 0.002,\r\n    springLength: 100,\r\n    springConstant: 0.01,\r\n  }\r\n  for (const [k, v] of Object.entries(defaults)) {\r\n    if (!(k in atlas)) {\r\n      atlas[k] = v\r\n    }\r\n  }\r\n  if (!(\"edges\" in opt)) { opt.edges = {} }\r\n  if (!(\"font\" in opt.edges)) { opt.edges.font = {} }\r\n  if (!(\"size\" in opt.edges.font)) { opt.edges.font.size = 14 }\r\n  return opt\r\n}\r\n\r\n\r\ntype sliderProps = {\r\n  setOpt: (opt: any) => void,\r\n  getOpt: () => any,\r\n}\r\n\r\nconst GravitationalConstantSlider = (props: sliderProps) => {\r\n  const opt = defaultOpt(props.getOpt())\r\n  let atlas = opt.physics.forceAtlas2Based\r\n  const [value, setValue] = useState(atlas.gravitationalConstant)\r\n\r\n  const handleChange = (event: any, newValue: number | number[]) => {\r\n    atlas.gravitationalConstant = newValue\r\n    setValue(newValue)\r\n    props.setOpt(opt)\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <Typography gutterBottom>\r\n        引力常数\r\n      </Typography>\r\n      <Slider\r\n        value={value}\r\n        onChange={handleChange}\r\n        min={-100}\r\n        max={0}\r\n        valueLabelDisplay=\"auto\"\r\n        aria-labelledby=\"continuous-slider\"\r\n      />\r\n    </>\r\n  )\r\n}\r\n\r\nconst SpringConstantSlider = (props: sliderProps) => {\r\n  const opt = defaultOpt(props.getOpt())\r\n  let atlas = opt.physics.forceAtlas2Based\r\n  const [value, setValue] = useState(Math.log10(atlas.springConstant))\r\n\r\n  const handleChange = (event: any, newValue: number | number[]) => {\r\n    const newVal = 10**(newValue as number)\r\n    atlas.springConstant = newVal\r\n    setValue(newValue as number)\r\n    props.setOpt(opt)\r\n  }\r\n\r\n  const labelFormat = (value: number) => {\r\n    return \"1e^\" + value\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <Typography gutterBottom>\r\n        弹簧常数\r\n      </Typography>\r\n      <Slider\r\n        value={value}\r\n        onChange={handleChange}\r\n        step={0.5}\r\n        min={-5}\r\n        max={0}\r\n        valueLabelDisplay=\"auto\"\r\n        valueLabelFormat={labelFormat}\r\n        aria-labelledby=\"non-linear-slider\"\r\n      />\r\n    </>\r\n  )\r\n}\r\n\r\nconst CustomSwitch = withStyles({\r\n  switchBase: {\r\n    color: \"#3f51b5\",\r\n    '&$checked': {\r\n      color: \"#3f51b5\",\r\n    },\r\n    '&$checked + $track': {\r\n      backgroundColor: \"#3f51b5\",\r\n    },\r\n  },\r\n  checked: {},\r\n  track: {},\r\n})(Switch);\r\n\r\n\r\nconst PhysicsSwitch = (props: sliderProps) => {\r\n  const opt = defaultOpt(props.getOpt())\r\n  const [value, setValue] = useState(opt.physics.enabled)\r\n\r\n  const handleChange = (event: any) => {\r\n    const checked = event.target.checked\r\n    opt.physics.enabled = checked\r\n    setValue(checked)\r\n    props.setOpt(opt)\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <Typography gutterBottom>\r\n        物理效果\r\n      </Typography>\r\n      <CustomSwitch checked={value} onChange={handleChange} name=\"physicsCheck\" />\r\n    </>\r\n  )\r\n\r\n}\r\n\r\n\r\nconst HiddenEdgeLabelSwitch = (props: sliderProps) => {\r\n  const opt = defaultOpt(props.getOpt())\r\n  const [value, setValue] = useState(opt.edges.font.size === 0)\r\n\r\n  const handleChange = (event: any) => {\r\n    const checked = event.target.checked\r\n    if (checked) {\r\n      opt.edges.font.size = 0\r\n    } else {\r\n      opt.edges.font.size = 14\r\n    }\r\n    setValue(checked)\r\n    props.setOpt(opt)\r\n    console.log(opt)\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <Typography gutterBottom>\r\n        隐藏边标签\r\n      </Typography>\r\n      <CustomSwitch checked={value} onChange={handleChange} name=\"hiddenEdgeLabelCheck\" />\r\n    </>\r\n  )\r\n\r\n}\r\n\r\n\r\ntype TuneDialogProps = {\r\n  setOpt: (opt: any) => void,\r\n  getOpt: () => any,\r\n}\r\ntype TuneDialogState = {\r\n  open: boolean\r\n}\r\n\r\nclass TuneDialog extends React.Component<TuneDialogProps, TuneDialogState> {\r\n  constructor(props: TuneDialogProps) {\r\n    super(props)\r\n    this.state = {\r\n      open: false,\r\n    }\r\n  }\r\n\r\n  handleClickOpen() {\r\n    this.setState({open: true})\r\n  };\r\n\r\n  handleClose() {\r\n    this.setState({open: false})\r\n  };\r\n\r\n  render() {\r\n    return (\r\n      <>\r\n        <Tooltip title=\"视图调整\" placement=\"top\">\r\n          <TuneIcon onClick={() => this.handleClickOpen()}/>\r\n        </Tooltip>\r\n        <Dialog open={this.state.open} onClose={() => {this.handleClose()}} aria-labelledby=\"form-dialog-title\">\r\n          <DialogTitle id=\"form-dialog-title\">网络视图调整</DialogTitle>\r\n          <DialogContent id=\"tuneDialog\">\r\n            <PhysicsSwitch\r\n              setOpt={this.props.setOpt}\r\n              getOpt={this.props.getOpt}/>\r\n            <GravitationalConstantSlider\r\n              setOpt={this.props.setOpt}\r\n              getOpt={this.props.getOpt}/>\r\n            <SpringConstantSlider\r\n              setOpt={this.props.setOpt}\r\n              getOpt={this.props.getOpt}/>\r\n            <HiddenEdgeLabelSwitch\r\n              setOpt={this.props.setOpt}\r\n              getOpt={this.props.getOpt}/>\r\n          </DialogContent>\r\n        </Dialog>\r\n      </>\r\n    )\r\n  }\r\n}\r\n\r\n\r\nconst InforBoardSwitch = (props: {switchState: boolean, setSwitch: (on: boolean) => void}) => {\r\n  const handleChange = (event: any) => {\r\n    const checked = event.target.checked\r\n    props.setSwitch(checked)\r\n  }\r\n\r\n  return (\r\n    <FormControlLabel\r\n      control={<CustomSwitch checked={props.switchState} onChange={handleChange} name=\"inforBoardCheck\" />}\r\n      label=\"弹出信息\"\r\n      labelPlacement=\"start\"\r\n    />\r\n    \r\n  )\r\n}\r\n\r\n\r\nconst HiddenUnselectedSwitch = (props: {switchState: boolean, setSwitch: (on: boolean) => void}) => {\r\n  const handleChange = (event: any) => {\r\n    const checked = event.target.checked\r\n    props.setSwitch(checked)\r\n  }\r\n\r\n  return (\r\n    <FormControlLabel\r\n      control={<CustomSwitch checked={props.switchState} onChange={handleChange} name=\"hiddenUnselectedCheck\" />}\r\n      label=\"隐藏未选中节点\"\r\n      labelPlacement=\"start\"\r\n    />\r\n    \r\n  )\r\n}\r\n\r\n\r\ntype SettingDialogProps = {\r\n  inforBoardSwitch: boolean,\r\n  setInforBoardSwitch: (on: boolean) => void,\r\n  hiddenUnselectedSwitch: boolean,\r\n  setHiddenUnselectedSwitch: (on: boolean) => void,\r\n}\r\ntype SettingDialogState = {\r\n  open: boolean\r\n}\r\n\r\nclass SettingDialog extends React.Component<SettingDialogProps, SettingDialogState> {\r\n  constructor(props: SettingDialogProps) {\r\n    super(props)\r\n    this.state = {\r\n      open: false\r\n    }\r\n  }\r\n\r\n  handleClickOpen() {\r\n    this.setState({open: true})\r\n  };\r\n\r\n  handleClose() {\r\n    this.setState({open: false})\r\n  };\r\n\r\n  render() {\r\n    return (\r\n      <>\r\n        <Tooltip title=\"设置\" placement=\"top\">\r\n          <SettingsIcon onClick={() => this.handleClickOpen()}/>\r\n        </Tooltip>\r\n        <Dialog open={this.state.open} onClose={() => {this.handleClose()}} aria-labelledby=\"form-dialog-title\">\r\n          <DialogTitle id=\"form-dialog-title\">设置</DialogTitle>\r\n          <DialogContent id=\"tuneDialog\">\r\n            <InforBoardSwitch\r\n              switchState={this.props.inforBoardSwitch}\r\n              setSwitch={this.props.setInforBoardSwitch}\r\n            />\r\n            <HiddenUnselectedSwitch\r\n              switchState={this.props.hiddenUnselectedSwitch}\r\n              setSwitch={this.props.setHiddenUnselectedSwitch}\r\n            />\r\n          </DialogContent>\r\n        </Dialog>\r\n      </>\r\n    )\r\n  }\r\n}\r\n\r\nexport {\r\n  EditOptionsDialog, SearchDialog,\r\n  FilterDialog, TuneDialog, SettingDialog,\r\n}\r\n","import React from 'react'\r\nimport Draggable from 'react-draggable';\r\nimport CloseIcon from '@material-ui/icons/Close';\r\n\r\nimport { shorterString } from './utils'\r\nimport { NodeType, CatType, Pos2d } from './datatypes'\r\n\r\n\r\ntype infoBoardProps = {\r\n  pos: Pos2d,\r\n  node: NodeType,\r\n  cats: Record<string, CatType>,\r\n  close: () => void,\r\n}\r\n\r\nexport default (props: infoBoardProps) => {\r\n  const node = props.node\r\n  const pos = props.pos\r\n  let cat = props.cats[node.categorie]\r\n  const boardStyle = {\r\n    top: pos.y + \"px\",\r\n    left: pos.x + \"px\",\r\n  }\r\n  const catStyle = 'color' in cat ? {color: cat.color} : {}\r\n  return (\r\n    <Draggable>\r\n      <div className=\"infoBoard\" style={boardStyle}>\r\n        <CloseIcon className=\"closeButton\" onClick={() => props.close()} />\r\n        <div className=\"content\">\r\n          <img src={('image' in node) ? node.image : ''} alt=\"\"/>\r\n          <div className=\"title\">\r\n            <div className=\"name\">\r\n              {node.label}\r\n            </div>\r\n            <div className=\"categorie\" style={catStyle}>\r\n              {(cat !== undefined) ? cat.label : \"\"}\r\n            </div>\r\n          </div>\r\n          <div className=\"describe\">\r\n            { shorterString(node.info, 80) }\r\n          </div>\r\n          {\r\n            ('link' in node) && (node['link'] !== \"\") ?\r\n            <a className=\"link\" href={node.link}>链接</a> :\r\n            null\r\n          }\r\n        </div>\r\n      </div>\r\n    </Draggable>\r\n  )\r\n}\r\n","/** Come from:\r\n *     https://material-ui.com/zh/components/progress/#circular-with-label\r\n */\r\n\r\nimport React from 'react';\r\nimport CircularProgress, { CircularProgressProps } from '@material-ui/core/CircularProgress';\r\nimport Typography from '@material-ui/core/Typography';\r\nimport Box from '@material-ui/core/Box';\r\n\r\nexport default (props: CircularProgressProps & { value: number }) => {\r\n  if (props.value >= 100) {\r\n    return (<></>)\r\n  }\r\n  return (\r\n    <Box position=\"relative\" display=\"inline-flex\">\r\n      <CircularProgress {...props} />\r\n      <Box\r\n        top={0}\r\n        left={0}\r\n        bottom={0}\r\n        right={0}\r\n        position=\"absolute\"\r\n        display=\"flex\"\r\n        alignItems=\"center\"\r\n        justifyContent=\"center\"\r\n      >\r\n        <Typography variant=\"caption\" component=\"div\" color=\"textSecondary\">\r\n          {`${Math.round( props.value,)}%`}\r\n        </Typography>\r\n      </Box>\r\n    </Box>\r\n  );\r\n}\r\n","import React, { useState } from 'react'\r\nimport FullscreenIcon from '@material-ui/icons/Fullscreen'\r\nimport FullscreenExitIcon from '@material-ui/icons/FullscreenExit';\r\nimport Tooltip from '@material-ui/core/Tooltip';\r\nimport PhotoCameraIcon from '@material-ui/icons/PhotoCamera';\r\nimport { Network as NetworkType, IdType } from 'vis/index'\r\n\r\n\r\nimport { EditOptionsDialog, SearchDialog, FilterDialog, TuneDialog, SettingDialog } from './ViewDialogs'\r\nimport { Network, Node, Edge } from 'react-vis-network'\r\nimport { ItemInfo, NodeType, EdgeType, CatType, Pos2d } from './datatypes'\r\nimport InfoBoard from './InfoBoard'\r\nimport CircularProgress from './CircularProgressWithLabel'\r\n\r\n\r\nconst getCanvas = () => document.getElementsByTagName(\"canvas\")[0]\r\n\r\n\r\nconst DefaultNetStyle = {\r\n  NodeColor: \"#66bbff\",\r\n  NodeBorderWidth: 3,\r\n}\r\n\r\n\r\nconst createNode = (n: NodeType, catgories: Record<string, CatType>) => {\r\n  let cat = catgories[n.categorie]\r\n  let color;\r\n  if (cat) {\r\n    color = cat.color\r\n  } else {\r\n    color = DefaultNetStyle.NodeColor\r\n  }\r\n  return (\r\n    <Node key={n.id}\r\n      id={n.id} label={n.label}\r\n      shape=\"circularImage\"\r\n      image={n.image}\r\n      color={color}\r\n      borderWidth={DefaultNetStyle.NodeBorderWidth}\r\n    />\r\n  )\r\n}\r\n\r\nconst createEdge = (e: EdgeType) => {\r\n  let arrows = \"\"\r\n  if (('direction' in e) && (e['direction'] === true)) { arrows = \"to\" }\r\n  return (\r\n    <Edge key={e.id} id={e.id} arrows={arrows}\r\n          from={e.from} to={e.to} label={e.label}\r\n    />\r\n  )\r\n}\r\n\r\n\r\ntype ViewControlProps = {\r\n  setOpt: (opt: any) => void,\r\n  getOpt: () => any,\r\n  captureImg: () => void,\r\n  queryAndFocus: (q: string) => void,\r\n  queryAndFilter: (q: string, reverse: boolean) => void,\r\n  reset: () => void,\r\n  inforBoardSwitch: boolean,\r\n  setInforBoardSwitch: (on: boolean) => void,\r\n  hiddenUnselectedSwitch: boolean,\r\n  setHiddenUnselectedSwitch: (on: boolean) => void,\r\n}\r\n\r\nconst ViewControl = (props: ViewControlProps) => {\r\n  const [fullScreenMode, setFullScreenMode] = useState(false)\r\n  let oriHeight = 300\r\n\r\n  const enterFullScreen = () => {\r\n    let canvas = getCanvas()\r\n    let fullRegion = document.getElementById(\"full-screen-region\")\r\n    fullRegion?.requestFullscreen()\r\n    oriHeight = canvas.clientHeight\r\n    canvas.style.height = window.screen.height + \"px\";\r\n    setFullScreenMode(true)\r\n    document.addEventListener('fullscreenchange', (event) => {\r\n      if (!(document.fullscreenElement)) {\r\n        turnBackSize()\r\n        setFullScreenMode(false)\r\n      }\r\n    });\r\n  }\r\n\r\n  const turnBackSize = () => {\r\n    let canvas = getCanvas()\r\n    canvas.style.height = oriHeight + \"px\"\r\n  }\r\n\r\n  const exitFullScreen = () => {\r\n    document.exitFullscreen()\r\n    turnBackSize()\r\n    setFullScreenMode(false)\r\n  }\r\n\r\n  return (\r\n    <div className=\"viewControl\">\r\n      <SearchDialog queryAndFocus={props.queryAndFocus}/>\r\n      <FilterDialog queryAndFilter={props.queryAndFilter} reset={props.reset}/>\r\n      <Tooltip title=\"截图\" placement=\"top\"><PhotoCameraIcon onClick={() => props.captureImg()}/></Tooltip>\r\n      <TuneDialog setOpt={props.setOpt} getOpt={props.getOpt}/>\r\n      <EditOptionsDialog setOpt={props.setOpt} getOpt={props.getOpt}/>\r\n      <SettingDialog\r\n        inforBoardSwitch={props.inforBoardSwitch}\r\n        setInforBoardSwitch={props.setInforBoardSwitch}\r\n        hiddenUnselectedSwitch={props.hiddenUnselectedSwitch}\r\n        setHiddenUnselectedSwitch={props.setHiddenUnselectedSwitch}\r\n      />\r\n      {fullScreenMode\r\n      ? <Tooltip title=\"退出全屏\" placement=\"top\"><FullscreenExitIcon onClick={exitFullScreen}/></Tooltip>\r\n      : <Tooltip title=\"全屏\" placement=\"top\"><FullscreenIcon onClick={enterFullScreen}/></Tooltip>\r\n      }\r\n    </div>\r\n  )\r\n}\r\n\r\nconst DEFAULT_NETWORK_OPTIONS = {\r\n  autoResize: false,\r\n  nodes: {\r\n    shape: \"dot\",\r\n  },\r\n  physics: {\r\n    enabled: true,\r\n    stabilization: false,\r\n    solver: 'forceAtlas2Based',\r\n    forceAtlas2Based: {\r\n      gravitationalConstant: -20,\r\n      centralGravity: 0.002,\r\n      springLength: 100,\r\n      springConstant: 0.01\r\n    },\r\n  },\r\n  edges: {\r\n    width: 0.3,\r\n    color: {\r\n      inherit: \"to\"\r\n    }\r\n  },\r\n  interaction: {\r\n    hideEdgesOnDrag: false,\r\n    hover: true,\r\n    multiselect: true,\r\n  }\r\n}\r\n\r\ntype NetViewProps = {\r\n  info: ItemInfo,\r\n  setNodes: (nodes: Array<NodeType>) => void,\r\n  queryNodes: (q: string, reverse: boolean) => Array<NodeType>,\r\n}\r\n\r\ntype NetworkRef = {\r\n  network: NetworkType\r\n}\r\n\r\ntype NetViewState = {\r\n  infoBoard: JSX.Element | null,\r\n  loadingRatio: number,\r\n  inforBoardSwitch: boolean,\r\n  netRef: React.RefObject<NetworkRef>,\r\n  netOptions: any,\r\n  oldNodes: Array<NodeType>,\r\n  hiddenUnselectedSwitch: boolean,\r\n}\r\n\r\nexport default class NetView extends React.Component<NetViewProps, NetViewState> {\r\n  constructor(props: NetViewProps) {\r\n    super(props)\r\n    this.state = {\r\n      infoBoard: null,\r\n      loadingRatio: 0,\r\n      inforBoardSwitch: true,\r\n      netRef: React.createRef(),\r\n      netOptions: null,\r\n      oldNodes: props.info.data.nodes,\r\n      hiddenUnselectedSwitch: false\r\n    }\r\n  }\r\n\r\n  setHiddenUnselectedSwitch(on: boolean) {\r\n    const oldState = this.state.hiddenUnselectedSwitch\r\n    if ((oldState === true) && (on === false)) {\r\n      this.resetNodes()\r\n    } else if((oldState === false) && (on === true)) {\r\n      this.hiddenNonSelected()\r\n    }\r\n    this.setState({\r\n      hiddenUnselectedSwitch: on\r\n    })\r\n  }\r\n\r\n  handlePopup (params: any) {\r\n    const network = (this.state.netRef.current as NetworkRef).network\r\n    const node_id = network.getNodeAt(params.pointer.DOM)\r\n    const select_node = (typeof node_id !== \"undefined\")\r\n    console.log(node_id)\r\n    const pos: Pos2d = {x: 20, y: 20}\r\n\r\n    const create_board = () => {\r\n      let node = this.props.info.data.nodes.find((n) => (n.id === node_id))\r\n      return <InfoBoard pos={pos} node={node as NodeType}\r\n                        cats={this.props.info.categories}\r\n                        close={() => (this.setState({infoBoard: null}))}/>\r\n    }\r\n\r\n    let board = this.state.infoBoard\r\n    if (select_node && (board === null) && this.state.inforBoardSwitch) {\r\n      this.setState({infoBoard: create_board()})\r\n    } else if (select_node && (board !== null) && this.state.inforBoardSwitch) {\r\n      this.setState({infoBoard: create_board()})\r\n    } else if (board !== null ) {\r\n      this.setState({infoBoard: null})\r\n    }\r\n  }\r\n\r\n  handleHidden(params: any) {\r\n    if (!(this.state.hiddenUnselectedSwitch)) {return}\r\n    const select_node = (params.nodes.length > 0)\r\n    if (select_node) {\r\n      this.hiddenNonSelected()\r\n    } else {\r\n      this.resetNodes()\r\n    }\r\n  }\r\n\r\n  handleClick(params: any) {\r\n    this.handlePopup(params)\r\n    this.handleHidden(params)\r\n  }\r\n\r\n  setInforBoardSwitch(on: boolean) {\r\n    this.setState({\r\n      inforBoardSwitch: on\r\n    })\r\n  }\r\n\r\n  setNetOptions(options: any) {\r\n    let network = (this.state.netRef.current as NetworkRef).network\r\n    network.setOptions(options)\r\n    this.setState({netOptions: options})\r\n  }\r\n\r\n  getNetOptions() {\r\n    return this.state.netOptions\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.setNetOptions(DEFAULT_NETWORK_OPTIONS)\r\n    this.registerLoading()\r\n  }\r\n\r\n  createNetwork() {\r\n    let info = this.props.info\r\n    const network = (\r\n      <>\r\n      {this.createLoadindBar()}\r\n      <Network ref={this.state.netRef} onClick={(params: any) => {this.handleClick(params)}} >\r\n        {info.data.nodes.map(n => createNode(n, info.categories))}\r\n        {info.data.edges.map((e) => createEdge(e))}\r\n      </Network>\r\n      </>\r\n    )\r\n    return network\r\n  }\r\n\r\n  createLoadindBar() {\r\n    return (\r\n      <div id=\"progressBar\">\r\n        <CircularProgress variant=\"determinate\" value={this.state.loadingRatio * 100}/>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  registerLoading() {\r\n    // https://jsfiddle.net/api/post/library/pure/\r\n    const self = this\r\n    const ref = (this.state.netRef.current as NetworkRef).network\r\n    ref.on(\"stabilizationProgress\", function (params: any) {\r\n      const ratio = params.iterations / params.total;\r\n      self.setState({loadingRatio: ratio})\r\n    })\r\n    ref.once(\"stabilizationIterationsDone\", function () {\r\n      self.setState({loadingRatio: 1})\r\n    })\r\n  }\r\n\r\n  captureImg() {\r\n    const canvas = getCanvas()\r\n    // Fill the canvas background, see: \r\n    //   https://stackoverflow.com/questions/50104437/set-background-color-to-save-canvas-chart\r\n    const context = canvas.getContext('2d')\r\n    if (context !== null) {\r\n      context.save()\r\n      context.globalCompositeOperation = 'destination-over'\r\n      context.fillStyle = \"#ffffff\"\r\n      context.fillRect(0, 0, canvas.width, canvas.height)\r\n      context.restore()\r\n    }\r\n\r\n    const img = canvas.toDataURL(\"image/png\", 1.0)\r\n    const url = img.replace(/^data:image\\/[^;]/, 'data:application/octet-stream')\r\n    let a = document.createElement('a');\r\n    a.download = \"network.png\";\r\n    a.href = url\r\n    a.target = '_blank';\r\n    document.body.appendChild(a);\r\n    a.click();\r\n    document.body.removeChild(a);\r\n  }\r\n\r\n  queryNodesAndFocus(q:string) {\r\n    const nodes = this.props.queryNodes(q, false)\r\n    if (nodes.length <= 0) {return}\r\n    const network = (this.state.netRef.current as NetworkRef).network\r\n    network.selectNodes([])\r\n    const nodes_id = nodes.map(n => String(n.id))\r\n    if (nodes.length > 1) {\r\n      network.fit({nodes: nodes_id, animation: true})\r\n    } else {\r\n      network.focus(nodes_id[0], {scale: 1, animation: true})\r\n    }\r\n    network.selectNodes(nodes_id)\r\n  }\r\n\r\n  queryNodesAndFilter(q:string, reverse:boolean) {\r\n    const nodes = this.props.queryNodes(q, reverse)\r\n    this.props.setNodes(nodes)\r\n  }\r\n\r\n  resetNodes() {\r\n    this.props.setNodes(this.state.oldNodes)\r\n  }\r\n\r\n  getSelectedClosure() {\r\n    const network = (this.state.netRef.current as NetworkRef).network\r\n    const selected = network.getSelectedNodes()\r\n    let closure: Set<IdType> = new Set();\r\n    for (const nid of selected) {\r\n      closure.add( parseInt(String(nid)) )\r\n      const connected = network.getConnectedNodes(nid)\r\n      for (const nid2 of (connected as IdType[])) {\r\n        closure.add( parseInt(String(nid2)) )\r\n      }\r\n    }\r\n    return closure\r\n  }\r\n\r\n  hiddenNonSelected() {\r\n    this.resetNodes()\r\n    const closure = this.getSelectedClosure()\r\n    let nodes = []\r\n    for (const n of this.state.oldNodes) {\r\n      if (closure.has(n.id)) {\r\n        nodes.push(n)\r\n      }\r\n    }\r\n    this.props.setNodes(nodes)\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"netView\">\r\n        <div className=\"canvas-wrap\" id=\"full-screen-region\">\r\n          {this.createNetwork()}\r\n          {this.state.infoBoard}\r\n          <ViewControl\r\n            setOpt={this.setNetOptions.bind(this)}\r\n            getOpt={this.getNetOptions.bind(this)}\r\n            captureImg={this.captureImg.bind(this)}\r\n            queryAndFocus={this.queryNodesAndFocus.bind(this)}\r\n            queryAndFilter={this.queryNodesAndFilter.bind(this)}\r\n            reset={this.resetNodes.bind(this)}\r\n            inforBoardSwitch={this.state.inforBoardSwitch}\r\n            setInforBoardSwitch={this.setInforBoardSwitch.bind(this)}\r\n            hiddenUnselectedSwitch={this.state.hiddenUnselectedSwitch}\r\n            setHiddenUnselectedSwitch={this.setHiddenUnselectedSwitch.bind(this)}\r\n          />\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n","/**\r\n * Modified from this:\r\n *   https://material-ui.com/zh/components/slider/#custom-marks\r\n */\r\nimport React from 'react';\r\nimport { makeStyles, Theme, createStyles } from '@material-ui/core/styles';\r\nimport Slider from '@material-ui/core/Slider';\r\n\r\nimport { TimePoint } from './datatypes';\r\n\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n  createStyles({\r\n    root: {\r\n      width: 400,\r\n    },\r\n    margin: {\r\n      height: theme.spacing(3),\r\n    },\r\n  }),\r\n);\r\n\r\ntype TimeSliderProps = {\r\n    time: number,\r\n    timePoints: Array<TimePoint>,\r\n    setTime: (t: number) => void,\r\n}\r\n\r\nexport default (props: TimeSliderProps) => {\r\n  if (props.timePoints.length < 2) { return (<></>) }\r\n  const classes = useStyles();\r\n\r\n  let i = -1;\r\n  const marks = props.timePoints.map(t => {\r\n    i += 1\r\n    return {\r\n      value: i,\r\n      label: t.label\r\n    }\r\n  })\r\n\r\n  const handleChange = (event: any, newValue: number | number[]) => {\r\n    const t = newValue as number\r\n    props.setTime(t)\r\n  }\r\n\r\n  return (\r\n    <div className={classes.root+\" timeSlider\"}>\r\n        <div className=\"label\">时间轴</div>\r\n        <div className=\"slider\">\r\n          <Slider\r\n            defaultValue={props.time}\r\n            aria-labelledby=\"discrete-slider-custom\"\r\n            min={0}\r\n            max={props.timePoints.length-1}\r\n            step={null}\r\n            valueLabelDisplay=\"off\"\r\n            marks={marks}\r\n            onChange={handleChange}\r\n          />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","// Implement the Table style editor of nodes, edges and categories\r\n//\r\n// This file is copy then modified from devexetreme-reactive demo:\r\n//   https://devexpress.github.io/devextreme-reactive/react/grid/demos/featured/data-editing/\r\n\r\nimport React from 'react';\r\nimport {\r\n  SortingState, EditingState, PagingState, SummaryState,\r\n  IntegratedPaging, IntegratedSorting,\r\n} from '@devexpress/dx-react-grid';\r\nimport {\r\n  Grid,\r\n  Table, TableHeaderRow, TableEditRow, TableEditColumn,\r\n  PagingPanel, TableColumnReordering,\r\n  TableFixedColumns, \r\n} from '@devexpress/dx-react-grid-material-ui';\r\nimport Paper from '@material-ui/core/Paper';\r\nimport Button from '@material-ui/core/Button';\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport Input from '@material-ui/core/Input';\r\nimport Select from '@material-ui/core/Select';\r\nimport MenuItem from '@material-ui/core/MenuItem';\r\nimport TableCell from '@material-ui/core/TableCell';\r\n\r\nimport DeleteIcon from '@material-ui/icons/Delete';\r\nimport EditIcon from '@material-ui/icons/Edit';\r\nimport SaveIcon from '@material-ui/icons/Save';\r\nimport CancelIcon from '@material-ui/icons/Cancel';\r\nimport { withStyles } from '@material-ui/core/styles';\r\n\r\n\r\nconst styles = theme => ({\r\n  lookupEditCell: {\r\n    padding: theme.spacing(1),\r\n  },\r\n  dialog: {\r\n    width: 'calc(100% - 16px)',\r\n  },\r\n  inputRoot: {\r\n    width: '100%',\r\n  },\r\n  selectMenu: {\r\n    position: 'absolute !important',\r\n  },\r\n});\r\n\r\nconst AddButton = ({ onExecute }) => (\r\n  <div style={{ textAlign: 'center' }}>\r\n    <Button\r\n      color=\"primary\"\r\n      onClick={onExecute}\r\n      title=\"Create new row\"\r\n    >\r\n      New\r\n    </Button>\r\n  </div>\r\n);\r\n\r\nconst EditButton = ({ onExecute }) => (\r\n  <IconButton onClick={onExecute} title=\"Edit row\">\r\n    <EditIcon />\r\n  </IconButton>\r\n);\r\n\r\nconst DeleteButton = ({ onExecute }) => (\r\n  <IconButton\r\n    onClick={() => {\r\n      // eslint-disable-next-line\r\n      if (window.confirm('Are you sure you want to delete this row?')) {\r\n        onExecute();\r\n      }\r\n    }}\r\n    title=\"Delete row\"\r\n  >\r\n    <DeleteIcon />\r\n  </IconButton>\r\n);\r\n\r\nconst CommitButton = ({ onExecute }) => (\r\n  <IconButton onClick={onExecute} title=\"Save changes\">\r\n    <SaveIcon />\r\n  </IconButton>\r\n);\r\n\r\nconst CancelButton = ({ onExecute }) => (\r\n  <IconButton color=\"secondary\" onClick={onExecute} title=\"Cancel changes\">\r\n    <CancelIcon />\r\n  </IconButton>\r\n);\r\n\r\nconst commandComponents = {\r\n  add: AddButton,\r\n  edit: EditButton,\r\n  delete: DeleteButton,\r\n  commit: CommitButton,\r\n  cancel: CancelButton,\r\n};\r\n\r\nconst Command = ({ id, onExecute }) => {\r\n  const CommandButton = commandComponents[id];\r\n  return (\r\n    <CommandButton\r\n      onExecute={onExecute}\r\n    />\r\n  );\r\n};\r\n\r\nconst availableValues = {\r\n  categorie: [\"person\", \"organization\"],\r\n  direction: [\"true\", \"false\"]\r\n};\r\n\r\nconst LookupEditCellBase = ({\r\n  availableColumnValues, value, onValueChange, classes,\r\n}) => (\r\n  <TableCell\r\n    className={classes.lookupEditCell}\r\n  >\r\n    <Select\r\n      value={value}\r\n      onChange={event => onValueChange(event.target.value)}\r\n      MenuProps={{\r\n        className: classes.selectMenu,\r\n      }}\r\n      input={(\r\n        <Input\r\n          classes={{ root: classes.inputRoot }}\r\n        />\r\n      )}\r\n    >\r\n      {availableColumnValues.map(item => (\r\n        <MenuItem key={item} value={item}>\r\n          {item}\r\n        </MenuItem>\r\n      ))}\r\n    </Select>\r\n  </TableCell>\r\n);\r\nexport const LookupEditCell = withStyles(styles, { name: 'ControlledModeDemo' })(LookupEditCellBase);\r\n\r\nconst EditCell = (props) => {\r\n  const { column } = props;\r\n  const availableColumnValues = availableValues[column.name];\r\n  if (availableColumnValues) {\r\n    return <LookupEditCell {...props} availableColumnValues={availableColumnValues} />;\r\n  }\r\n  return <TableEditRow.Cell {...props} />;\r\n};\r\n\r\nconst getRowId = row => row.id;\r\n\r\n/**\r\n * Generate an Editable Grid object\r\n */\r\nconst createGrid = (colDef, getParentState, widthDef, colOrder, defaultDef, setParentState) => {\r\n\r\n  class TheGrid extends React.Component {\r\n    \r\n    constructor(props) {\r\n      super(props)\r\n      this.state = {\r\n        columns: colDef,\r\n        rows: (typeof getParentState === \"function\") ? getParentState(props) : props[getParentState],\r\n        tableColumnExtensions: widthDef,\r\n        sorting: [],\r\n        editingRowIds: [],\r\n        addedRows: [],\r\n        rowChanges: {},\r\n        currentPage: 0,\r\n        pageSize: 5,\r\n        pageSizes: [5, 10, 0],\r\n        columnOrder: colOrder,\r\n        leftFixedColumns: [TableEditColumn.COLUMN_TYPE],\r\n        totalSummaryItems: []\r\n      }\r\n    }\r\n\r\n    changeAddedRows(value) {\r\n      let defaultRow = {}\r\n      for (const [k, v] of Object.entries(defaultDef)) {\r\n        if (typeof v === \"function\") {\r\n          defaultRow[k] = v(this.state.rows)\r\n        } else {\r\n          defaultRow[k] = v\r\n        }\r\n      }\r\n      console.log(defaultRow)\r\n      this.setState({\r\n        addedRows: value.map(row => (Object.keys(row).length ? row : defaultRow))\r\n      })\r\n    }\r\n\r\n    deleteRows(deletedIds) {\r\n      const rowsForDelete = this.state.rows.slice();\r\n      deletedIds.forEach((rowId) => {\r\n        const index = rowsForDelete.findIndex(row => row.id === rowId);\r\n        if (index > -1) {\r\n          rowsForDelete.splice(index, 1);\r\n        }\r\n      });\r\n      return rowsForDelete;\r\n    }\r\n\r\n    commitChanges({ added, changed, deleted }) {\r\n      const rows = this.state.rows\r\n      let changedRows;\r\n      if (added) {\r\n        const startingAddedId = rows.length > 0 ? rows[rows.length - 1].id + 1 : 0;\r\n        changedRows = [\r\n          ...rows,\r\n          ...added.map((row, index) => ({\r\n            id: startingAddedId + index,\r\n            ...row,\r\n          })),\r\n        ];\r\n      }\r\n      if (changed) {\r\n        changedRows = rows.map(row => (changed[row.id] ? { ...row, ...changed[row.id] } : row));\r\n      }\r\n      if (deleted) {\r\n        changedRows = this.deleteRows(deleted);\r\n      }\r\n      this.setState({\r\n        rows: changedRows\r\n      })\r\n      // change the state of parent component\r\n      setParentState(this.props, changedRows)\r\n    };\r\n\r\n  /**\r\n   * re-render rows when receive new props, see:\r\n   *   https://stackoverflow.com/questions/41233458/react-child-component-not-updating-after-parent-state-change\r\n   */\r\n  componentWillReceiveProps(nextProps) {\r\n    const newRows = (typeof getParentState === \"function\") ? getParentState(nextProps) : nextProps[getParentState]\r\n    this.setState({ rows: newRows });  \r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Paper>\r\n        <Grid\r\n          rows={this.state.rows}\r\n          columns={this.state.columns}\r\n          getRowId={getRowId}\r\n        >\r\n          <SortingState\r\n            sorting={this.state.sorting}\r\n            onSortingChange={(s) => {this.setState({sorting: s})}}\r\n          />\r\n          <PagingState\r\n            currentPage={this.state.currentPage}\r\n            onCurrentPageChange={(c) => this.setState({currentPage: c})}\r\n            pageSize={this.state.pageSize}\r\n            onPageSizeChange={(s) => this.setState({pageSize: s})}\r\n          />\r\n          <EditingState\r\n            editingRowIds={this.state.editingRowIds}\r\n            onEditingRowIdsChange={(ids) => {this.setState({editingRowIds: ids})}}\r\n            rowChanges={this.state.rowChanges}\r\n            onRowChangesChange={(c) => {this.setState({rowChanges: c})}}\r\n            addedRows={this.state.addedRows}\r\n            onAddedRowsChange={this.changeAddedRows.bind(this)}\r\n            onCommitChanges={this.commitChanges.bind(this)}\r\n          />\r\n          <SummaryState\r\n            totalItems={this.state.totalSummaryItems}\r\n          />\r\n\r\n          <IntegratedSorting />\r\n          <IntegratedPaging />\r\n\r\n          <Table\r\n            columnExtensions={this.state.tableColumnExtensions}\r\n          />\r\n          <TableColumnReordering\r\n            order={this.state.columnOrder}\r\n            onOrderChange={(c) => this.setState({columnOrder: c})}\r\n          />\r\n          <TableHeaderRow showSortingControls />\r\n          <TableEditRow\r\n            cellComponent={EditCell}\r\n          />\r\n          <TableEditColumn\r\n            width={150}\r\n            showAddCommand={!this.state.addedRows.length}\r\n            showEditCommand\r\n            showDeleteCommand\r\n            commandComponent={Command}\r\n          />\r\n          <TableFixedColumns\r\n            leftColumns={this.state.leftFixedColumns}\r\n          />\r\n          <PagingPanel\r\n            pageSizes={this.state.pageSizes}\r\n          />\r\n        </Grid>\r\n      </Paper>\r\n    );\r\n  }\r\n\r\n  }\r\n\r\n  return TheGrid\r\n\r\n}\r\n\r\nconst NodeGrid = createGrid(\r\n  [\r\n    { name: 'id', title: 'ID' },\r\n    { name: 'label', title: '标签' },\r\n    { name: 'categorie', title: '类别' },\r\n    { name: 'info', title: '信息' },\r\n    { name: 'image', title: '图片' },\r\n    { name: 'link', title: '链接' },\r\n  ],\r\n  \"nodes\",\r\n  [\r\n    { columnName: 'id', width: 80 },\r\n    { columnName: 'label', width: 100 },\r\n    { columnName: 'categorie', width: 100},\r\n    { columnName: 'info', width: 300 },\r\n    { columnName: 'image', width: 200 },\r\n    { columnName: 'link', width: 200 },\r\n  ],\r\n  ['id', 'label', 'categorie', 'info', 'image', 'link'],\r\n  {\r\n    id: (rows) => (rows.length > 0) ? Math.max(...rows.map((r) => r.id)) + 1 : 0,\r\n    label: \"\",\r\n    categorie: availableValues.categorie[0],\r\n    info: \"\",\r\n    image: \"\",\r\n    link: \"\"\r\n  },\r\n  (props, changedRows) => {props.setNodes(changedRows.map((r) => {return {...r, id: parseInt(String(r.id))}}))}\r\n)\r\n\r\nconst reprEdges = (edges) => edges.map((e_) => {\r\n  let e = Object.assign({}, e_)\r\n  e.direction = String(e.direction)\r\n  return e\r\n})\r\n\r\nconst recoverEdges = (rows) => rows.map((e_) => {\r\n  let e = Object.assign({}, e_)\r\n  e.id = parseInt(String(e.id))\r\n  e.direction = (e.direction === \"false\") ? false : true\r\n  return e\r\n})\r\n\r\nconst EdgeGrid = createGrid(\r\n  [\r\n    { name: 'id', title: 'ID' },\r\n    { name: 'from', title: 'from' },\r\n    { name: 'to', title: 'to' },\r\n    { name: 'label', title: '标签' },\r\n    { name: 'direction', title: '有向？' }\r\n  ],\r\n  (props) => reprEdges(props.edges),\r\n  [\r\n    { columnName: 'id', width: 100 },\r\n    { columnName: 'from', width: 100 },\r\n    { columnName: 'to', width: 100},\r\n    { columnName: 'label', width: 120 },\r\n    { columnName: 'direction', width: 100 },\r\n  ],\r\n  ['id', 'from', 'to', 'label', 'direction'],\r\n  {\r\n    id: (rows) => (rows.length > 0) ? Math.max(...rows.map((r) => r.id)) + 1 : 0,\r\n    label: \"\",\r\n    direction: availableValues.direction[0],\r\n    info: \"\",\r\n    image: \"\",\r\n    link: \"\"\r\n  },\r\n  (props, changedRows) => {props.setEdges(recoverEdges(changedRows))}\r\n)\r\n\r\nconst reprCats = (cats) => {\r\n  let rows = []\r\n  for (const [k, v] of Object.entries(cats)) {\r\n    let row = Object.assign({id: k}, v)\r\n    rows.push(row)\r\n  }\r\n  return rows\r\n}\r\n\r\nconst recoverCats = (rows) => {\r\n  let cats = {}\r\n  for (const r of rows) {\r\n    let v = Object.assign({}, r)\r\n    delete v.id\r\n    cats[r.id] = v\r\n  }\r\n  return cats\r\n}\r\n\r\nconst CatGrid = createGrid(\r\n  [\r\n    { name: 'id', title: 'ID' },\r\n    { name: 'label', title: '标签' },\r\n    { name: 'color', title: '颜色' }\r\n  ],\r\n  (props) => {\r\n    const cats = props.cats\r\n    availableValues.categorie = Object.keys(cats)\r\n    return reprCats(cats)\r\n  },\r\n  [\r\n    { columnName: 'id', width: 200 },\r\n    { columnName: 'label', width: 200 },\r\n    { columnName: 'color', width: 200},\r\n  ],\r\n  ['id', 'label', 'color'],\r\n  {\r\n    id: \"\",\r\n    label: \"\",\r\n    color: \"#aaaaaa\"\r\n  },\r\n  (props, changedRows) => {\r\n    availableValues.categorie = changedRows.map((r) => r.id)\r\n    props.setCats(recoverCats(changedRows))\r\n  }\r\n)\r\n\r\nexport { NodeGrid, EdgeGrid, CatGrid }\r\n","import React, {Component} from \"react\";\r\nimport Accordion from '@material-ui/core/Accordion';\r\nimport AccordionSummary from '@material-ui/core/AccordionSummary';\r\nimport AccordionDetails from '@material-ui/core/AccordionDetails';\r\nimport Typography from '@material-ui/core/Typography';\r\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore';\r\n\r\n\r\ntype CommentsProps = {\r\n  issueTerm: string,\r\n}\r\n\r\n/**\r\n * Reference:\r\n *   + https://github.com/utterance/utterances/issues/161\r\n *   + https://material-ui.com/zh/components/accordion/\r\n */\r\nexport default class Comments extends Component<CommentsProps, {}> {\r\n\r\n  componentDidMount () {\r\n      let script = document.createElement(\"script\");\r\n      let anchor = document.getElementById(\"inject-comments-for-uterances\");\r\n      if (anchor !== null) {\r\n        script.setAttribute(\"src\", \"https://utteranc.es/client.js\");\r\n        script.setAttribute(\"crossorigin\", \"anonymous\");\r\n        script.setAttribute(\"async\", \"true\");\r\n        script.setAttribute(\"repo\", \"AniNet-Project/aninet-project.github.io\");\r\n        script.setAttribute(\"issue-term\", this.props.issueTerm);\r\n        script.setAttribute( \"theme\", \"github-light\");\r\n        anchor.appendChild(script);\r\n      }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n        <>\r\n          <div className=\"comments\">\r\n\r\n          <Accordion>\r\n            <AccordionSummary\r\n              expandIcon={<ExpandMoreIcon />}\r\n              aria-controls=\"panel1a-content\"\r\n            >\r\n              <Typography>评论区</Typography>\r\n            </AccordionSummary>\r\n            <AccordionDetails id=\"comments-content\">\r\n              <div id=\"inject-comments-for-uterances\"></div>\r\n            </AccordionDetails>\r\n          </Accordion>\r\n\r\n          </div>\r\n        </>\r\n    );\r\n  }\r\n}\r\n","import React from 'react'\r\nimport { Tab, Tabs, TabList, TabPanel } from 'react-tabs'\r\nimport 'react-tabs/style/react-tabs.css'\r\n\r\nimport './NetPage.css'\r\nimport Header from './Header'\r\nimport Footer from './Footer'\r\nimport ToolBar from './ToolBar'\r\nimport NetView from './NetView'\r\nimport TimeSlider from './TimeSlider'\r\nimport {NetItem, TimePoint, ItemInfo, NodeType, EdgeType, CatType} from './datatypes'\r\nimport { NodeGrid, EdgeGrid, CatGrid } from './EditGrid'\r\nimport Comments from './Comments'\r\n\r\n\r\n\r\nconst preProcessInfo = (info: ItemInfo) => {\r\n  let new_nodes: Array<NodeType> = []\r\n  for (let n of info.data.nodes) {\r\n    n.id = parseInt(String(n.id))\r\n    new_nodes.push(n)\r\n  }\r\n  info.data.nodes = new_nodes\r\n  return info\r\n}\r\n\r\n\r\ntype NetPageProps = {\r\n  item: NetItem\r\n}\r\n\r\ntype NetPageState = {\r\n  error: null | Error,\r\n  isLoaded: boolean,\r\n  timesInfo: Array<ItemInfo>,\r\n  currentTime: number,\r\n  timePoints: Array<TimePoint>,\r\n  nodeCache: Array<Record<number, NodeType>>\r\n}\r\n\r\n\r\nclass NetPage extends React.Component<NetPageProps, NetPageState> {\r\n  constructor(props: NetPageProps) {\r\n    super(props)\r\n    this.state = {\r\n      error: null,\r\n      isLoaded: false,\r\n      timesInfo: [],\r\n      currentTime: 0,\r\n      timePoints: [],\r\n      nodeCache: [],\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    let item = this.props.item\r\n    let timepoints: Array<TimePoint> = []\r\n    if (typeof item.url === \"string\") {\r\n      timepoints.push({label: \"common\", url: item.url})\r\n    } else {\r\n      timepoints = item.url\r\n    }\r\n    this.setState({timesInfo: new Array(timepoints.length)})\r\n    Promise.all(\r\n      timepoints.map((t) => fetch(t.url).then(resp => resp.json()))\r\n    )\r\n    .then( infos_ => {\r\n      const infos = infos_ as [ItemInfo]\r\n      this.setState({\r\n        isLoaded: true,\r\n        timesInfo: infos.map(info => preProcessInfo(info)),\r\n        timePoints: timepoints,\r\n        nodeCache: infos.map(info => {\r\n          let cache: Record<number, NodeType> = {}\r\n          for (const n of info.data.nodes) {\r\n            cache[n.id] = n\r\n          }\r\n          return cache\r\n        })\r\n      })\r\n    },\r\n    (error) => {\r\n      this.setState({\r\n        isLoaded: true,\r\n        error\r\n      })\r\n    })\r\n  }\r\n\r\n  setNodes(nodes: Array<NodeType>) {\r\n    let times = this.state.timesInfo\r\n    let info = times[this.state.currentTime]\r\n    if (info !== null) {\r\n      info.data.nodes = nodes\r\n      this.setState({timesInfo: times})\r\n    }\r\n  }\r\n\r\n  setEdges(edges: Array<EdgeType>) {\r\n    let times = this.state.timesInfo\r\n    let info = times[this.state.currentTime]\r\n    if (info !== null) {\r\n      info.data.edges = edges\r\n      this.setState({timesInfo: times})\r\n    }\r\n  }\r\n\r\n  setCategories(categories: Record<string, CatType>) {\r\n    let times = this.state.timesInfo\r\n    let info = times[this.state.currentTime]\r\n    if (info != null) {\r\n      info.categories = categories\r\n      this.setState({timesInfo: times})\r\n    }\r\n  }\r\n\r\n  setInfo(info: ItemInfo) {\r\n    let times = this.state.timesInfo\r\n    times[this.state.currentTime] = info\r\n    this.setState({timesInfo: times})\r\n  }\r\n\r\n  setCurrentTime(t: number) {\r\n    this.setState({currentTime: t})\r\n  }\r\n\r\n  queryNodes(q:string, reverse:boolean = false) {\r\n    let query_type = \"label\"\r\n    let query_text = \"\"\r\n    const items = q.split(\":\")\r\n    if (items.length === 1) {\r\n      query_text = items[0]\r\n    } else if (items.length === 2) {\r\n      query_type = items[0]\r\n      query_text = items[1].trim()\r\n    } else {\r\n      return []\r\n    }\r\n    let res = []\r\n\r\n    const times = this.state.timesInfo\r\n    const info = times[this.state.currentTime]\r\n    const nodeCache = this.state.nodeCache[this.state.currentTime]\r\n    const nodes = info.data.nodes\r\n    const toggle = (cond: boolean) => reverse ? (!cond) : cond\r\n    try {\r\n      if (query_type === \"id\") {\r\n        const n = nodeCache[parseInt(query_text)]\r\n        if (n !== undefined) {\r\n          res.push(n)\r\n        }\r\n      } else {\r\n        const pattern = new RegExp(query_text)\r\n        for (let n of nodes) {\r\n          if (!(query_type in n)) {continue}\r\n          const val = (n as any)[query_type]\r\n          if (toggle(pattern.test(String(val)))) {\r\n            res.push(n)\r\n          }\r\n        }\r\n      }\r\n      return res\r\n    } catch(e) {\r\n      console.log(e)\r\n      return []\r\n    }\r\n  }\r\n\r\n  render() {\r\n    let item = this.props.item\r\n    const { error, isLoaded, timesInfo, currentTime } = this.state\r\n    if (error) {\r\n      return <div>Error: {error.message}</div>\r\n    } else if (!isLoaded) {\r\n      return <div>Loading...</div>\r\n    } else {\r\n      const info = timesInfo[currentTime]\r\n      return (\r\n        <div>\r\n          <Header title={item.name}/>\r\n          <div className=\"container\">\r\n          <ToolBar\r\n            info={info}\r\n            setInfo={this.setInfo.bind(this)}\r\n            queryNodes={this.queryNodes.bind(this)}\r\n            />\r\n          <div className=\"tabs\">\r\n            <Tabs>\r\n              <TabList>\r\n                <Tab>网络视图</Tab>\r\n                <Tab>节点(Nodes)</Tab>\r\n                <Tab>边(Edges)</Tab>\r\n                <Tab>节点类别</Tab>\r\n              </TabList>\r\n              <TabPanel forceRender={true}>\r\n                <NetView\r\n                  info={info}\r\n                  setNodes={this.setNodes.bind(this)}\r\n                  queryNodes={this.queryNodes.bind(this)}\r\n                  />\r\n              </TabPanel>\r\n              <TabPanel forceRender={true}>\r\n                <NodeGrid nodes={info.data.nodes} setNodes={this.setNodes.bind(this)}/>\r\n              </TabPanel>\r\n              <TabPanel forceRender={true}>\r\n                <EdgeGrid edges={info.data.edges} setEdges={this.setEdges.bind(this)}/>\r\n              </TabPanel>\r\n              <TabPanel forceRender={true}>\r\n                <CatGrid cats={info.categories} setCats={this.setCategories.bind(this)}/>\r\n              </TabPanel>\r\n            </Tabs>\r\n          </div>\r\n\r\n          <TimeSlider\r\n            time={this.state.currentTime}\r\n            timePoints={this.state.timePoints}\r\n            setTime={this.setCurrentTime.bind(this)}\r\n          />\r\n\r\n          <Comments issueTerm={item.name}/>\r\n\r\n          </div>\r\n          <Footer/>\r\n        </div>\r\n      )\r\n    }\r\n  }\r\n}\r\n\r\nexport default NetPage\r\n","/**\r\n * Come from here:\r\n *   https://medium.com/young-developer/react-markdown-code-and-syntax-highlighting-632d2f9b4ada\r\n */\r\n\r\nimport React, { PureComponent } from \"react\";\r\nimport PropTypes from \"prop-types\";\r\nimport { Prism as SyntaxHighlighter } from \"react-syntax-highlighter\";\r\n\r\ntype CodeBlockProps = {\r\n    language: string,\r\n    value: string,\r\n}\r\n\r\nclass CodeBlock extends PureComponent<CodeBlockProps, {}> {\r\n  static propTypes = {\r\n    value: PropTypes.string.isRequired,\r\n    language: PropTypes.string\r\n  };\r\n\r\n  static defaultProps = {\r\n    language: null\r\n  };\r\n\r\n  render() {\r\n    const { language, value } = this.props;\r\n    return (\r\n      <SyntaxHighlighter language={language}>\r\n        {value}\r\n      </SyntaxHighlighter>\r\n    );\r\n  }\r\n}\r\n\r\nexport default CodeBlock;\r\n","import React from 'react'\r\nimport ReactMarkdown from 'react-markdown'\r\n\r\nimport CodeBlock from \"./CodeBlock\"\r\nimport Header from './Header'\r\nimport Footer from './Footer'\r\nimport './DocPage.css'\r\n\r\n\r\ntype DocPageProps = {\r\n  title: string,\r\n  sourceUrl: string,\r\n}\r\ntype DocPageState = {\r\n  error: null | Error,\r\n  isLoaded: boolean,\r\n  content: string | null,\r\n}\r\n\r\n\r\nexport default class DocPage extends React.Component<DocPageProps, DocPageState> {\r\n  constructor(props: DocPageProps) {\r\n    super(props)\r\n    this.state = {\r\n      error: null,\r\n      isLoaded: false,\r\n      content: null,\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    const url = this.props.sourceUrl\r\n    fetch(url)\r\n      .then(res => res.text())\r\n      .then((data) => {\r\n        this.setState({\r\n          isLoaded: true,\r\n          content: data\r\n        })\r\n      },\r\n      (error) => {\r\n        this.setState({\r\n          isLoaded: true,\r\n          error\r\n        })\r\n      })\r\n  }\r\n\r\n  render() {\r\n    const { error, isLoaded, content } = this.state\r\n    if (error) {\r\n      return <div>Error: {error.message}</div>\r\n    } else if (!isLoaded) {\r\n      return <div>Loading...</div>\r\n    } else {\r\n      return (\r\n        <>\r\n          <Header title={this.props.title}/>\r\n          <div className=\"container\">\r\n            <div className=\"doc\">\r\n              <ReactMarkdown\r\n                source={content as string}\r\n                renderers={{ code: CodeBlock }}\r\n                escapeHtml={false}\r\n              />\r\n            </div>\r\n          </div>\r\n          <Footer/>\r\n        </>\r\n      )\r\n    }\r\n  }\r\n\r\n}\r\n","import React from 'react';\r\nimport {\r\n  HashRouter as Router,\r\n  Route\r\n} from 'react-router-dom'\r\nimport './App.css';\r\nimport NetPage from './NetPage'\r\nimport Header from './Header'\r\nimport Footer from './Footer'\r\nimport { NetItem } from './datatypes';\r\nimport AddCircleOutlineIcon from '@material-ui/icons/AddCircleOutline';\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport Tooltip from '@material-ui/core/Tooltip';\r\nimport DocPage from './DocPage';\r\n\r\ntype CardProps = {\r\n  item: NetItem\r\n}\r\n\r\nclass Card extends React.Component<CardProps, object> {\r\n  render() {\r\n    let item = this.props.item\r\n    return (\r\n      <a href={\"#/network/\"+item.name}>\r\n      <div className=\"card\">\r\n        <img className=\"titleImg\" src={item.titleImg} alt={item.name}></img>\r\n        <p className=\"name\">{item.name}</p>\r\n      </div>\r\n      </a>\r\n    )\r\n  }\r\n}\r\n\r\nclass NewCard extends React.Component<CardProps, object> {\r\n  render() {\r\n    let item = this.props.item\r\n    return (\r\n        <div className=\"card\" id=\"newCard\">\r\n          <a href={\"#/network/\"+item.name}>\r\n            <Tooltip title=\"新建空白页\" placement=\"top\">\r\n              <IconButton type=\"submit\" id=\"newPageButton\" >\r\n                <AddCircleOutlineIcon id=\"newPageIcon\"/>\r\n              </IconButton>\r\n            </Tooltip>\r\n          </a>\r\n        </div>\r\n    )\r\n  }\r\n}\r\n\r\ntype CardsProps = {\r\n  items: Array<NetItem>\r\n}\r\n\r\nclass Cards extends React.Component<CardsProps, object> {\r\n  render() {\r\n    const items = this.props.items\r\n    return (\r\n      <div className=\"cards\">\r\n        {items.map(item => (\r\n          (item.name === \"新建网络\")\r\n          ? <NewCard key={item.name} item={item}/>\r\n          : <Card key={item.name} item={item}/>\r\n        ))}\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\ntype HomeProps = {\r\n  items: Array<NetItem>\r\n}\r\n\r\nclass Home extends React.Component<HomeProps, object> {\r\n  render() {\r\n    let items = this.props.items\r\n    return (\r\n      <div className=\"App\">\r\n        <Header title=\"ACG人物关系可视化\"/>\r\n        <div className=\"contents\">\r\n          <div className=\"container\">\r\n            <Cards items={items}/>\r\n          </div>\r\n        </div>\r\n        <Footer/>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\ntype AppProps = {}\r\ntype AppState = {\r\n  error: Error | null,\r\n  isLoaded: boolean,\r\n  items: Array<NetItem>\r\n}\r\n\r\nclass App extends React.Component<AppProps, AppState> {\r\n  constructor(props: AppProps) {\r\n    super(props)\r\n    this.state = {\r\n      error: null,\r\n      isLoaded: false,\r\n      items: []\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    fetch(\"networks.json\")\r\n      .then(res => res.json())\r\n      .then((data) => {\r\n        this.setState({\r\n          isLoaded: true,\r\n          items: data\r\n        })\r\n      },\r\n      (error) => {\r\n        this.setState({\r\n          isLoaded: true,\r\n          error\r\n        })\r\n      })\r\n  }\r\n\r\n  render() {\r\n    let { error, isLoaded, items } = this.state\r\n    const emptyItem = {name: \"新建网络\", titleImg: \"\", url: \"data/empty.json\"}\r\n    items = items.concat([emptyItem])\r\n    if (error) {\r\n      return <div>Error: {error.message}</div>\r\n    } else if (!isLoaded) {\r\n      return <div>Loading...</div>\r\n    } else {\r\n      return (\r\n        <Router basename=\"/\">\r\n          <Route key=\"home\" exact path=\"/\" component={() => <Home items={items}/>} />\r\n          {items.map(item => (\r\n            <Route key={item.name} path={\"/network/\"+item.name}\r\n                   component={() => <NetPage item={item}/>} />\r\n          ))}\r\n          <Route key=\"contribute\" path={\"/contribute\"}\r\n                 component={() => <DocPage title=\"如何贡献\" sourceUrl={\"docs/contribute.md\"}/>} />\r\n          <Route key=\"about\" path={\"/about\"}\r\n                 component={() => <DocPage title=\"关于\" sourceUrl={\"docs/about.md\"}/>}\r\n                 />\r\n        </Router>\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\nexport default App;\r\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}